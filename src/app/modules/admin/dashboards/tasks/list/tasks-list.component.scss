@import 'frappe-gantt';

/* ==========================================================================
   ESTRUCTURA BASE DE LA TABLA (FLEX-BASED)
   ========================================================================== */
::ng-deep table.mat-table {
    background: transparent;
    display: flex;
    flex-direction: column;
    width: 100% !important;
    /* Permite que la tabla se expanda horizontalmente si las columnas crecen */
    min-width: max-content !important;
    border-collapse: collapse;

    tr.mat-header-row,
    tr.mat-row {
        display: flex !important;
        align-items: stretch;
        /* Asegura que todas las celdas tengan la misma altura */
        width: fit-content !important;
        /* El row se ajusta al total de sus celdas */
        min-width: 100%;
        box-sizing: border-box;
    }

    tr.mat-header-row {
        height: 42px;
        background: #f8fafc;
        border-bottom: 1px solid #e5e7eb;
        position: sticky;
        top: 0;
        z-index: 100;
    }

    tr.mat-row {
        min-height: 48px;
        background: #fff;
        border-bottom: 1px solid #f1f5f9;
        transition: background-color 0.1s ease;

        &:hover {
            background-color: #f9fafb !important;
        }
    }
}

/* ==========================================================================
   CELDAS Y COMPORTAMIENTO DE REDIMENSIONAMIENTO
   ========================================================================== */
::ng-deep th.mat-header-cell,
td.mat-cell {
    display: flex !important;
    align-items: center;
    padding: 0 12px;
    box-sizing: border-box;
    position: relative;
    /* Importante: Evita que el contenido rompa el ancho manual */
    overflow: hidden;

    // Cuando el ancho es inyectado por el TS (ej: width: 200px), 
    // el navegador ignorar치 flex-grow gracias a esta regla:
    &[style*="width"] {
        flex: none !important;
    }

    &.border-r {
        border-right: 1px solid #e5e7eb;
    }
}

::ng-deep th.mat-header-cell {
    overflow: visible !important;
    /* El resizer handle debe sobresalir */
    font-size: 12px;
    font-weight: 700;
    color: #475569;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    user-select: none;
}

/* Los estilos de .resizer antiguos se han eliminado para usar .native-resizer de forma consistente */

/* ==========================================================================
   ESTADOS DE ARRASTRE Y OTROS
   ========================================================================== */
.is-resizing {
    cursor: col-resize !important;
    user-select: none !important;

    * {
        pointer-events: none !important;
        /* Evita tooltips o clicks mientras arrastras */
    }
}

::ng-deep .column-drag-handle {
    cursor: grab;
    margin-right: 8px;
    color: #cbd5e1;

    &:active {
        cursor: grabbing;
    }

    &:hover {
        color: #64748b;
    }
}

/* ==========================================================================
   SCROLLBAR PERSONALIZADO
   ========================================================================== */
::ng-deep .overflow-y-auto,
::ng-deep .overflow-x-auto {
    &::-webkit-scrollbar {
        width: 8px;
        height: 8px;
    }

    &::-webkit-scrollbar-track {
        background: #f1f5f9;
    }

    &::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 10px;
        border: 2px solid #f1f5f9;

        &:hover {
            background: #94a3b8;
        }
    }
}


/* Evita que Angular Material corte el mango del resizer */
::ng-deep .mat-header-cell {
    overflow: visible !important;
}

::ng-deep th[style*="width"],
::ng-deep td[style*="width"] {
    flex: none !important;
    /* Bloquea el estiramiento autom치tico de Flexbox */
}

.group-table-wrapper {
    .mat-header-cell {
        position: relative;
        overflow: visible !important; // Para que el mango se vea

    }
}

// Bloquea la selecci칩n de texto mientras haces resize
.is-resizing {
    user-select: none;
    cursor: col-resize;
}

/* En tu archivo de estilos .scss */

::ng-deep .mat-header-cell,
::ng-deep .mat-cell {
    /* Permite que el contenido se oculte si la columna es m치s peque침a que el texto */
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    white-space: nowrap !important;

    /* Resetear comportamientos de flex que fuerzan tama침os m칤nimos */
    flex: none !important;
    box-sizing: border-box !important;

    /* Evitar que las columnas desaparezcan por completo o se encimen los t칤tulos */
    min-width: 70px !important;
}

/* El contenedor interno debe permitir el encogimiento y truncar el texto */
::ng-deep .mat-header-cell>div {
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    white-space: nowrap !important;
    display: flex !important;
    align-items: center;
    width: 100% !important;
    min-width: 0 !important;
    /* Permite que el flex container se encoja correctamente */

    // Si hay un span dentro para el texto, forzamos el truncamiento
    span {
        display: block !important;
        overflow: hidden !important;
        text-overflow: ellipsis !important;
        white-space: nowrap !important;
        flex: 1;
        min-width: 0;
    }

    // El icono no debe encogerse y debe estar oculto si no cabe
    mat-icon {
        flex: none !important;
    }
}

table {
    table-layout: fixed;
    /* Esto acelera el renderizado y respeta estrictamente los anchos */
    width: min-content;
    /* Permite que la tabla crezca horizontalmente si hay muchas columnas */
}

td.mat-column-asignados,
td.mat-column-responsable {
    padding: 0 8px !important;
}

.cursor-help {
    cursor: help;
}

// Estilo para que los avatares se vean n칤tidos
.rounded-full {
    user-select: none;

    &.bg-slate-500 {
        background-color: #64748b;
    }

    &.bg-indigo-600 {
        background-color: #4f46e5;
    }
}

.group-container {
    transition: all 0.2s ease-in-out;

    // Quitar el padding por defecto para que la tabla llegue a los bordes
    .group-table-wrapper {
        border-radius: 0 0 8px 8px;
        overflow: hidden;
    }

    table {
        border-collapse: separate;
        border-spacing: 0;

        // Estilo para las celdas del cuerpo
        td.mat-cell {
            border-bottom: 1px solid rgba(0, 0, 0, 0.03);
            border-right: 1px solid rgba(0, 0, 0, 0.03);
            transition: background-color 0.2s;

            &:last-child {
                border-right: none;
            }
        }

        // Resaltar la fila completa en hover
        tr.mat-row:hover td {
            background-color: rgba(0, 0, 0, 0.02) !important;
        }

        // Estilo especial para la columna de ESTATUS
        .mat-column-estatus {
            padding: 0 !important; // Para que el color llene toda la celda

            .status-cell-fill {
                height: 100%;
                width: 100%;
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-weight: 600;
                font-size: 11px;
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }
        }
    }
}

/* ==========================================================================
   TIPOGRAF칈A Y VISIBILIDAD DE TEXTOS
   ========================================================================== */

::ng-deep th.mat-header-cell {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    font-size: 11px;
    /* Un poco m치s peque침o para el estilo uppercase premium */
    font-weight: 800;
    /* Extra bold para headers */
    color: #475569;
    /* Gris pizarra oscuro para contraste */
    text-transform: uppercase;
    letter-spacing: 0.08em;
    /* M치s espaciado entre letras para facilitar lectura */
}

::ng-deep td.mat-cell {
    font-family: 'Inter', -apple-system, sans-serif;
    font-size: 13px;
    /* Tama침o ideal para lectura de datos */
    font-weight: 500;
    /* Medium para que la letra no se pierda en el fondo de color */
    color: #1e293b;
    /* Casi negro para m치ximo contraste */
    line-height: 1.5;
}

/* Estilo para los nombres de tareas (espec칤fico) */
.font-medium.text-gray-700 {
    font-weight: 600 !important;
    /* Un poco m치s de peso */
    color: #334155 !important;
}

/* Mejora la visibilidad del texto dentro del estatus s칩lido */
::ng-deep .mat-column-estatus .status-cell-fill {
    font-size: 10px !important;
    font-weight: 900 !important;
    /* Texto muy grueso para resaltar sobre el color */
    letter-spacing: 0.05em;
    text-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);
    /* Sombra sutil para despegar la letra del fondo */
    color: #ffffff !important;
}

/* ==========================================================================
   AJUSTES DE CONTRASTE EN FILAS
   ========================================================================== */

::ng-deep table.mat-table {
    /* ... tu c칩digo flex ... */

    tr.mat-row {
        /* Aumentamos la altura para dar m치s "aire" al texto */
        min-height: 52px !important;

        // Bordes m치s visibles pero suaves
        border-bottom: 1px solid rgba(226, 232, 240, 0.8) !important;
    }
}

/* Evita el efecto de texto "borroso" en pantallas de baja resoluci칩n */
* {
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

/* ==========================================================================
   TIPOGRAF칈A Y VISIBILIDAD DE TEXTOS
   ========================================================================== */

::ng-deep td.mat-cell {
    font-family: 'Inter', sans-serif;
    font-size: 13px;
    font-weight: 500;
    color: #334155;
    /* Gris azulado muy oscuro (mejor que negro puro) */
}

/* Columna de estatus ajustada: Texto Oscuro sobre Fondo Pastel */
::ng-deep .mat-column-estatus {
    .status-cell-fill {
        height: 100%;
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        /* Quitamos el text-shadow y el color blanco */
        font-size: 10px !important;
        font-weight: 800 !important;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        /* El color se inyectar치 desde el TS o puedes usar clases */
    }
}

/* Mejoramos el hover para que sea sutil */
::ng-deep tr.mat-row:hover {
    background-color: rgba(0, 0, 0, 0.02) !important;
}

// 游댳 Estilos Premium para Frappe Gantt
::ng-deep {
    .gantt-target {
        .grid-header {
            fill: #f8fafc;
            stroke: #e2e8f0;
        }

        .grid-row {
            fill: #ffffff;
        }

        .grid-row:nth-child(even) {
            fill: #f8fafc;
        }

        .tick {
            stroke: #e2e8f0;
        }

        .upper-text {
            fill: #64748b;
            font-weight: 700;
            text-transform: uppercase;
            font-size: 10px;
        }

        .lower-text {
            fill: #94a3b8;
            font-size: 10px;
        }

        // Barras de Tareas
        .bar {
            fill: #94a3b8;
        }

        .bar-progress {
            fill: #6366f1;
        }

        .bar-label {
            fill: #1e293b !important;
            font-weight: 600;
            font-size: 11px;
        }

        // Colores por Estatus (Sincronizados con getColorByEstatusId)
        .gantt-pending {
            .bar {
                fill: rgba(251, 39, 93, 0.1);
                stroke: #fb275d;
            }

            .bar-progress {
                fill: #fb275d;
            }
        }

        .gantt-progress {
            .bar {
                fill: rgba(255, 203, 0, 0.1);
                stroke: #ffcb00;
            }

            .bar-progress {
                fill: #ffcb00;
            }
        }

        .gantt-completed {
            .bar {
                fill: rgba(0, 200, 117, 0.1);
                stroke: #00c875;
            }

            .bar-progress {
                fill: #00c875;
            }
        }

        // Popup / Tooltip Custom
        .details-container {
            background: white;
            padding: 0;
            border-radius: 8px;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1);
            border: 1px solid #f1f5f9;
        }
    }
}