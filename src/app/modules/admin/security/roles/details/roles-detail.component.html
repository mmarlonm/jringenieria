<div class="flex flex-col w-full min-w-0 bg-card dark:bg-transparent">

  @if (!editMode) {
  <div class="relative h-40 w-full bg-accent-100 px-8 dark:bg-accent-700 sm:h-48 sm:px-12">
    <img class="absolute inset-0 h-full w-full object-cover" src="images/pages/profile/cover-jr-site.jpg" alt="Cover" />
    <div class="mx-auto flex w-full max-w-3xl items-center justify-end pt-6">
      <a mat-icon-button [matTooltip]="'Cerrar'" [routerLink]="['../']">
        <mat-icon class="text-white" [svgIcon]="'heroicons_outline:x-mark'"></mat-icon>
      </a>
    </div>
  </div>

  <div class="relative flex flex-auto flex-col items-center p-6 pt-0 sm:p-12 sm:pt-0">
    <div class="w-full max-w-3xl">

      <div class="-mt-16 flex flex-auto items-end mb-4">
        <div
          class="flex items-center justify-center w-32 h-32 rounded-full border-4 border-white bg-gray-200 dark:border-gray-900 dark:bg-gray-700 text-gray-500 shadow-sm">
          <mat-icon class="icon-size-14" [svgIcon]="'heroicons_outline:user-group'"></mat-icon>
        </div>

        <div class="mb-1 ml-auto flex items-center">
          <button (click)="toggleEditMode(true)" mat-flat-button [color]="'primary'">
            <mat-icon [svgIcon]="'heroicons_outline:pencil-square'"></mat-icon>
            <span class="ml-2">Editar Permisos</span>
          </button>
        </div>
      </div>

      <div class="mt-3 truncate text-4xl font-bold text-gray-800 dark:text-gray-100 tracking-tight">
        {{ rol?.nombreRol }}
      </div>
      <div class="text-secondary font-medium">Rol de Sistema</div>

      <div class="mt-6 flex flex-col space-y-4 border-t border-b py-6 border-gray-200 dark:border-gray-700">
        <div class="flex items-center text-gray-600 dark:text-gray-300">
          <mat-icon class="icon-size-5 text-hint" [svgIcon]="'heroicons_outline:identification'"></mat-icon>
          <span class="ml-3 font-medium">ID de Referencia: <span class="text-black dark:text-white font-mono">{{
              rol?.rolId }}</span></span>
        </div>
        <div class="flex items-center text-gray-600 dark:text-gray-300">
          <mat-icon class="icon-size-5 text-green-500" [svgIcon]="'heroicons_outline:shield-check'"></mat-icon>
          <span class="ml-3 font-medium">Estado: <span
              class="px-2 py-0.5 rounded-full bg-green-100 text-green-800 text-xs font-bold uppercase tracking-wide">Activo</span></span>
        </div>
      </div>

      <div class="mt-8">
        <h3 class="text-lg font-bold mb-4 flex items-center">
          <mat-icon class="icon-size-5 mr-2 text-primary" [svgIcon]="'heroicons_outline:lock-closed'"></mat-icon>
          Permisos Asignados Actualmente
        </h3>

        <div class="bg-gray-50 dark:bg-gray-800/50 rounded-2xl p-6 border border-gray-200 dark:border-gray-700">
          <div class="pointer-events-none opacity-90 grayscale-[10%]">
            @if (navigation && navigation.length > 0) {
            <app-role-navigation [navigation]="navigation" [selectedPermissions]="selectedPermissions">
            </app-role-navigation>
            } @else {
            <div class="flex flex-col items-center justify-center py-8 text-secondary">
              <mat-spinner [diameter]="30"></mat-spinner>
              <span class="mt-2 text-sm">Cargando permisos...</span>
            </div>
            }
          </div>
        </div>
      </div>

    </div>
  </div>
  }

  @if (editMode) {
  <div class="relative h-40 w-full bg-accent-100 px-8 dark:bg-accent-700 sm:h-48 sm:px-12">
    <img class="absolute inset-0 h-full w-full object-cover opacity-50 grayscale"
      src="images/pages/profile/cover-jr-site.jpg" alt="Cover" />
    <div class="mx-auto flex w-full max-w-3xl items-center justify-end pt-6">
      <a mat-icon-button [matTooltip]="'Cancelar'" [routerLink]="['../']">
        <mat-icon class="text-white" [svgIcon]="'heroicons_outline:x-mark'"></mat-icon>
      </a>
    </div>
  </div>

  <div class="relative flex flex-auto flex-col items-center px-6 sm:px-12">
    <div class="w-full max-w-3xl">
      <form [formGroup]="contactForm">

        <div class="mt-8">
          <mat-form-field class="w-full" [subscriptSizing]="'dynamic'">
            <mat-label>Nombre del Rol</mat-label>
            <mat-icon matPrefix class="hidden icon-size-5 sm:flex" [svgIcon]="'heroicons_solid:user-circle'"></mat-icon>
            <input matInput [formControlName]="'nombreRol'" [placeholder]="'Ej. Administrador de Ventas'"
              [spellcheck]="false" />
            <mat-error *ngIf="contactForm.get('nombreRol').hasError('required')">El nombre es obligatorio</mat-error>
          </mat-form-field>
        </div>

        <div class="mt-12">
          <div class="flex items-center justify-between mb-4">
            <div>
              <h2 class="text-2xl font-bold tracking-tight">Estructura de Permisos</h2>
              <p class="text-secondary">Expanda las secciones y marque los m칩dulos a los que el rol tendr치 acceso.</p>
            </div>
          </div>

          <div class="bg-card shadow rounded-2xl overflow-hidden border border-gray-200 dark:border-gray-700">
            @if (navigation && navigation.length > 0) {
            <div class="p-6 max-h-160 overflow-y-auto">
              <app-role-navigation [navigation]="navigation" [selectedPermissions]="selectedPermissions"
                (permisosSeleccionados)="actualizarPermisos($event)">
              </app-role-navigation>
            </div>
            } @else {
            <div class="flex flex-col items-center justify-center p-12">
              <mat-spinner [diameter]="40"></mat-spinner>
              <span class="mt-4 text-secondary font-medium">Cargando 치rbol de navegaci칩n...</span>
            </div>
            }
          </div>
        </div>

        <div
          class="flex items-center justify-between mt-10 mb-12 py-6 border-t bg-gray-50 dark:bg-transparent -mx-6 px-6 sm:-mx-12 sm:px-12">
          <button mat-button [color]="'warn'" (click)="deleteContact()" type="button" class="font-semibold">
            ELIMINAR ROL
          </button>

          <div class="flex items-center space-x-3">
            <button mat-button (click)="toggleEditMode(false)" type="button">
              Cancelar
            </button>
            <button mat-flat-button [color]="'primary'" [disabled]="contactForm.invalid" (click)="updateContact()"
              type="button">
              <mat-icon class="icon-size-5 mr-2" [svgIcon]="'heroicons_outline:check'"></mat-icon>
              GUARDAR CAMBIOS
            </button>
          </div>
        </div>

      </form>
    </div>
  </div>
  }
</div>