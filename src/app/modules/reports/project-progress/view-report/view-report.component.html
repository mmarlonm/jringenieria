<div class="project-report-container mat-elevation-z2">

    <header class="report-header">
        <mat-select placeholder="Selecciona un proyecto"
                    [(value)]="searchProjectId"
                    (selectionChange)="loadProjectData()">
            <mat-option *ngFor="let project of projectlist"
                        [value]="project.proyectoId">
                {{ project.nombre }}
            </mat-option>
        </mat-select>

        <span *ngIf="searchProjectId"
              class="status-badge {{ projectStatusClass }}">
            {{ projectStatus }}
        </span>
    </header>

    <mat-divider></mat-divider>

    <div *ngIf="!searchProjectId" class="select-message select-warning">
        <mat-icon>info</mat-icon>
        <p>Selecciona un proyecto para ver la información</p>
    </div>

    <ng-container *ngIf="searchProjectId">
        
        <div class="report-content-wrapper">

            <section class="metadata-bar">
                <div class="data-item">
                    <mat-icon color="primary">location_on</mat-icon>
                    <p matTooltip="{{ location }}">
                        <strong>Ubicación:</strong> {{ location }}
                    </p>
                </div>

                <div class="data-item">
                    <mat-icon color="primary">calendar_today</mat-icon>
                    <p>
                        <strong>Inicio:</strong> {{ startDate | date:'shortDate' }}
                        |
                        <strong>Entrega:</strong>
                        <span class="due-date">
                            {{ dueDate ? (dueDate | date:'shortDate') : 'No definida' }}
                        </span>
                    </p>
                </div>
            </section>

            <div class="quadrant-grid">

                <mat-card class="progress-card mat-elevation-z1">
                    <h2>Avance General del Proyecto</h2>
                    <div class="circular-chart"
                        [style.background]="'conic-gradient(#007bff ' + anticipoPercent + '%, #e0e0e0 0%)'">

                        <div class="inner-circle">
                            <p class="percentage improved-percent">
                                {{ anticipoPercent | number:'1.1-1' }}<small>%</small>
                            </p>
                            <div class="finance-breakdown improved-breakdown">
                        <p><strong>Total Proyecto:</strong> {{ financials.projectValue | currency:'MXN' }}</p>
                        <p><strong>Total Pendiente:</strong> {{ financials.pendingPayment | currency:'MXN' }}</p>
                    </div>
                        </div>
                    </div>
                    
                </mat-card>

                <mat-card class="financial-metrics-card mat-elevation-z1">
                    <h2>Métricas Financieras</h2>
                    <div class="financial-metrics">
                        <mat-card class="metric-card">
                            <h3>Valor del Proyecto</h3>
                            <p class="value">{{ financials.projectValue | currency:'USD':'symbol':'1.2-2' }}</p>
                        </mat-card>

                        <mat-card class="metric-card warning">
                            <h3>Pago Pendiente</h3>
                            <p class="value warning-text">
                                {{ financials.pendingPayment | currency:'USD':'symbol':'1.2-2' }}
                            </p>
                        </mat-card>

                        <mat-card class="metric-card accent">
                            <h3>Total de Anticipo</h3>
                            <p class="value accent-text">
                                {{ financials.totalAnticipo | currency:'USD':'symbol':'1.2-2' }}
                            </p>
                        </mat-card>
                    </div>
                </mat-card>

                <mat-card class="area-progress-card mat-elevation-z1">
                    <h2>Avances del Proyecto por Área</h2>

                    <div *ngIf="projectAreas.length === 0" class="no-data">
                        No hay avances registrados.
                    </div>

                    <div *ngFor="let area of projectAreas" class="progress-item">
                        <p>{{ area.name }} - {{ area.progress }}%</p>
                        <mat-progress-bar mode="determinate" [value]="area.progress"></mat-progress-bar>
                    </div>

                    <mat-divider class="small-divider"></mat-divider>

                    <div class="team-member-small">
                        <mat-icon color="accent">build</mat-icon>
                        <div>
                            <h3>Responsables Operativos</h3>
                            <p>{{ operationalLeaders }}</p>
                        </div>
                    </div>
                </mat-card>

                <mat-card class="supply-detail-card mat-elevation-z1">
                    <h2>Detalle de Suministros y Costos</h2>

                    <div class="mat-table-container">
                        <table mat-table [dataSource]="suppliesData">
                            <ng-container matColumnDef="component">
                                <th mat-header-cell *matHeaderCellDef> Componente </th>
                                <td mat-cell *matCellDef="let el"> {{ el.component }} </td>
                            </ng-container>
                            <ng-container matColumnDef="value">
                                <th mat-header-cell *matHeaderCellDef> Valor </th>
                                <td mat-cell *matCellDef="let el">
                                    {{ el.value | currency:'USD':'symbol':'1.2-2' }}
                                </td>
                            </ng-container>
                            <ng-container matColumnDef="progress">
                                <th mat-header-cell *matHeaderCellDef class="text-center">% Avance</th>
                                <td mat-cell *matCellDef="let el" class="text-center">
                                    <span class="progress-chip" [ngClass]="getProgressClass(el.progress)">
                                        {{ el.progress }}%
                                    </span>
                                </td>
                            </ng-container>

                            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                        </table>
                    </div>

                    <mat-divider class="small-divider"></mat-divider>

                    <div class="team-member-small">
                        <mat-icon color="primary">engineering</mat-icon>
                        <div>
                            <h3>Equipo del Proyecto</h3>
                            <p>{{ projectLeaders }}</p>
                        </div>
                    </div>
                </mat-card>

            </div> </div> </ng-container>

</div>