<form *ngIf="form" [formGroup]="form" (ngSubmit)="enviar()" class="p-4 sm:p-6 max-w-4xl mx-auto space-y-6">

  <!-- TÍTULO GENERAL -->
  <h1 class="text-center text-xl sm:text-2xl font-bold uppercase text-green-800">
    ENCUESTA DE SATISFACCIÓN DE SERVICIOS / PROYECTOS
  </h1>

  <!-- ENCUESTA YA RESPONDIDA -->
  <div *ngIf="encuestaYaRespondida"
    class="max-w-xl mx-auto my-8 bg-green-100 border border-green-400 rounded-2xl p-6 shadow-lg text-center">
    <h2 class="text-lg font-bold text-green-800 mb-2">
      Encuesta ya respondida
    </h2>
    <p class="text-green-900 text-sm">
      Esta encuesta ya fue contestada anteriormente.<br />
      El formulario se encuentra en modo lectura.
    </p>
  </div>

  <!-- FORMULARIO ACTIVO -->
  <ng-container *ngIf="!encuestaYaRespondida">

    <!-- ================= PASO 1 ================= -->
    <div *ngIf="step === 1" class="space-y-4">

      <h2 class="text-lg font-bold text-green-700">
        Datos del cliente
      </h2>

      <div class="grid grid-cols-1 md:grid-cols-1 gap-4">
        <mat-form-field appearance="outline">
          <mat-label>Nombre</mat-label>
          <input matInput formControlName="nombre" />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Empresa</mat-label>
          <input matInput formControlName="empresa" />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Email</mat-label>
          <input matInput formControlName="email" />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Teléfono</mat-label>
          <input matInput formControlName="telefono" />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Puesto</mat-label>
          <input matInput formControlName="puesto" />
        </mat-form-field>

        <!-- Sucursal (RADIOS) -->
        <div class="md:col-span-2 space-y-2">
          <label class="font-semibold block">Unidad de Negocio</label>
          <mat-radio-group formControlName="sucursal" class="flex flex-col gap-2">
            <mat-radio-button *ngFor="let unidad of unidadesDeNegocio" [value]="unidad.unidadId">
              {{ unidad.nombre }}
            </mat-radio-button>
          </mat-radio-group>
        </div>
      </div>

      <button mat-raised-button color="primary" class="w-full" (click)="step = 2" [disabled]="
          form.get('nombre')?.invalid ||
          form.get('empresa')?.invalid ||
          form.get('email')?.invalid ||
          form.get('telefono')?.invalid ||
          form.get('puesto')?.invalid ||
          form.get('sucursal')?.invalid
        ">
        Siguiente
      </button>
    </div>

    <!-- ================= PASO 2 (IMAGEN 2) ================= -->
    <div *ngIf="step === 2" class="space-y-6">

      <!-- LEYENDA -->
      <div class="bg-[#419486] p-4 rounded text-white space-y-2">
        <p class="font-bold">
          Estimado cliente.<br />
          En JR Ingeniería Eléctrica nos interesa mejorar nuestro servicio.
        </p>
        <p class="text-black font-bold">
          Por favor responde las siguientes preguntas.
        </p>
      </div>

      <h2 class="text-lg font-bold text-green-700">
        ¿Qué servicios te han sido proporcionados?
      </h2>

      <!-- SERVICIOS (CHECKBOX / RADIO SEGÚN IMAGEN) -->
      <mat-radio-group formControlName="serviciosRecibidos" class="grid grid-cols-1 sm:grid-cols-2 gap-2">
        <mat-radio-button value="Calidad de energía">
          Calidad de energía
        </mat-radio-button>

        <mat-radio-button value="Instalaciones eléctricas">
          Instalaciones eléctricas
        </mat-radio-button>

        <mat-radio-button value="Construcción de obra electromecánica">
          Construcción de obra electromecánica
        </mat-radio-button>

        <mat-radio-button value="Mantenimiento preventivo y correctivo">
          Mantenimiento preventivo y correctivo
        </mat-radio-button>

        <mat-radio-button value="Integración de centros de carga">
          Integración de centros de carga
        </mat-radio-button>

        <mat-radio-button value="Código de red">
          Código de red
        </mat-radio-button>

        <mat-radio-button value="Pruebas a transformadores">
          Pruebas a transformadores
        </mat-radio-button>

        <mat-radio-button value="Pruebas a cable VLF">
          Pruebas a cable VLF
        </mat-radio-button>

        <mat-radio-button value="Termografía">
          Termografía
        </mat-radio-button>

        <mat-radio-button value="Pararrayos">
          Pararrayos
        </mat-radio-button>

        <mat-radio-button value="Sistemas de tierras">
          Sistemas de tierras
        </mat-radio-button>

        <mat-radio-button value="Trámites y gestiones">
          Trámites y gestiones
        </mat-radio-button>

        <mat-radio-button value="Arc Flash">
          Arc Flash
        </mat-radio-button>

        <mat-radio-button value="Coordinación de protecciones">
          Coordinación de protecciones
        </mat-radio-button>

        <mat-radio-button value="Estudios de iluminación">
          Estudios de iluminación
        </mat-radio-button>

        <mat-radio-button value="Sistemas de monitoreo">
          Sistemas de monitoreo
        </mat-radio-button>
      </mat-radio-group>


      <div class="flex gap-4 pt-4">
        <button mat-stroked-button class="w-1/2" (click)="step = 1">
          Anterior
        </button>
        <button mat-raised-button color="primary" class="w-1/2" (click)="step = 3"
          [disabled]="form.get('serviciosRecibidos')?.invalid">
          Siguiente
        </button>
      </div>
    </div>

    <!-- ================= PASO 3 (IMAGEN 3) ================= -->
    <div *ngIf="step === 3" class="space-y-6">

      <!-- Título -->
      <div class="bg-[#b45309] text-white p-3 rounded font-semibold">
        Satisfacción general
      </div>

      <!-- Leyenda -->
      <div class="text-sm text-gray-700">
        Por favor indica tu respuesta en una escala del 0 al 10,
        donde 0 representa el nivel más bajo y 10 el más alto.
      </div>

      <!-- PREGUNTA 1 -->
      <div class="p-4 border rounded space-y-2">
        <label class="font-semibold block">
          ¿Cómo calificarías el servicio de parte del personal que te atendió?
        </label>

        <mat-radio-group formControlName="servicioPersonal" class="grid grid-cols-11 gap-1">
          <mat-radio-button *ngFor="let v of escalaNumerica" [value]="v">
            {{ v }}
          </mat-radio-button>
        </mat-radio-group>
      </div>

      <!-- PREGUNTA 2 -->
      <div class="p-4 border rounded space-y-2">
        <label class="font-semibold block">
          ¿Cuáles son las posibilidades de que recomiendes nuestros servicios a familiares, amigos y colegas?
        </label>

        <mat-radio-group formControlName="recomendarServicios" class="grid grid-cols-11 gap-1">
          <mat-radio-button *ngFor="let v of escalaNumerica" [value]="v">
            {{ v }}
          </mat-radio-button>
        </mat-radio-group>
      </div>

      <!-- PREGUNTA 3 -->
      <div class="p-4 border rounded space-y-2">
        <label class="font-semibold block">
          ¿En qué medida los servicios adquiridos a JR ayudaron a resolver tu problema?
        </label>

        <mat-radio-group formControlName="ayudaProblema" class="grid grid-cols-11 gap-1">
          <mat-radio-button *ngFor="let v of escalaNumerica" [value]="v">
            {{ v }}
          </mat-radio-button>
        </mat-radio-group>
      </div>

      <!-- PREGUNTA 4 -->
      <div class="p-4 border rounded space-y-2">
        <label class="font-semibold block">
          ¿Cómo evalúas el desarrollo de nuestros servicios/proyectos?
        </label>

        <mat-radio-group formControlName="desarrolloServicios" class="grid grid-cols-11 gap-1">
          <mat-radio-button *ngFor="let v of escalaNumerica" [value]="v">
            {{ v }}
          </mat-radio-button>
        </mat-radio-group>
      </div>

      <!-- PREGUNTA 5 -->
      <div class="p-4 border rounded space-y-2">
        <label class="font-semibold block">
          ¿Cómo evalúas el cumplimiento en cuanto a calidad y tiempos de entrega?
        </label>

        <mat-radio-group formControlName="calidadTiempo" class="grid grid-cols-11 gap-1">
          <mat-radio-button *ngFor="let v of escalaNumerica" [value]="v">
            {{ v }}
          </mat-radio-button>
        </mat-radio-group>
      </div>

      <!-- PREGUNTA ABIERTA -->
      <mat-form-field appearance="outline" class="w-full">
        <mat-label>¿Qué podemos mejorar para brindarte una mejor experiencia?</mat-label>
        <textarea matInput rows="3" formControlName="mejoras"></textarea>
      </mat-form-field>

      <!-- Navegación -->
      <div class="flex justify-between pt-4">
        <button mat-stroked-button type="button" (click)="step = 2" class="w-1/2">
          Atrás
        </button>

        <button mat-raised-button color="primary" class="w-1/2" (click)="step = 4" [disabled]="
      form.get('servicioPersonal')?.invalid ||
      form.get('recomendarServicios')?.invalid ||
      form.get('ayudaProblema')?.invalid ||
      form.get('desarrolloServicios')?.invalid ||
      form.get('calidadTiempo')?.invalid
    ">
          Siguiente
        </button>
      </div>

    </div>



    <!-- ================= PASO 4 (IMAGEN 4) ================= -->
    <div *ngIf="step === 4" class="space-y-4">

      <h2 class="text-lg font-bold text-green-700">
        Información final
      </h2>

      <mat-form-field appearance="outline" class="w-full">
        <mat-label>¿Qué servicios le gustaría que agreguemos?</mat-label>
        <textarea matInput rows="2" formControlName="productosDeseados"></textarea>
      </mat-form-field>

      <label class="font-semibold block">
        ¿Cómo conociste JR Ingeniería?
      </label>

      <mat-radio-group formControlName="comoConocio" class="grid grid-cols-1 sm:grid-cols-2 gap-2">
        <mat-radio-button value="Recomendación">Recomendación</mat-radio-button>
        <mat-radio-button value="Busqueda en internet">Búsqueda en internet</mat-radio-button>
        <mat-radio-button value="Facebook">Facebook</mat-radio-button>
        <mat-radio-button value="Instagram">Instagram</mat-radio-button>
        <mat-radio-button value="LinkedIn">LinkedIn</mat-radio-button>
        <mat-radio-button value="Web">Página Web</mat-radio-button>
      </mat-radio-group>

      <div class="flex gap-4 pt-4">
        <button mat-stroked-button class="w-1/2" (click)="step = 3">
          Anterior
        </button>
        <button mat-raised-button color="primary" class="w-1/2" type="submit" [disabled]="form.invalid">
          Enviar encuesta
        </button>
      </div>
    </div>

  </ng-container>
</form>