import{a as $,b as kt,c as P,d as Nt,e as Tt}from"./chunk-RVWJPYBM.js";import{a as zt}from"./chunk-KY3NGPN2.js";import{a as vt,b as xt,c as bt,d as St,e as Et,f as It,g as Mt,h as yt,i as Qt,j as wt,k as Dt,l as O}from"./chunk-4MVDCV4H.js";import{a as Ft,b as Lt,c as Rt,d as qt,e as Vt,f as $t}from"./chunk-7FAHWVTG.js";import"./chunk-OXDELVB2.js";import"./chunk-D7BAGR3P.js";import{a as L,d as rt,h as k,i as N,m as q,n as V}from"./chunk-P3BZCKAE.js";import{c as dt,e as u,g as ut,h as ct,k as pt,l as ft,n as ht,o as _t,q as Ct,s as R,t as gt}from"./chunk-QHIXCQYV.js";import{T as nt,ba as at,ga as T,ka as z,ma as mt,na as lt}from"./chunk-GZIOB5VH.js";import"./chunk-QWI5PWUG.js";import{a as st}from"./chunk-3BSPIKHY.js";import{e as tt,f as et,i as it,l as w,q as ot,x as D,z as F}from"./chunk-N75GUXKZ.js";import{$ as G,$a as d,$b as A,Hb as o,Ib as t,Jb as s,Kb as b,Lb as S,Nb as E,Tb as x,Vb as _,Zb as B,_b as U,ab as h,cc as I,dc as r,ea as J,ec as K,fc as C,ka as y,lc as Q,mc as W,tc as X,ua as g,ub as f,va as v,vc as Y,wb as c,wc as Z}from"./chunk-PTZSXNKB.js";import"./chunk-NEB6MB4Y.js";var j=(()=>{let a=class a{constructor(n){this.http=n,this.apiUrl=`${st.apiUrl}/Cotizacion`}get userInformation(){return localStorage.getItem("userInformation")??""}getQuotes(){return this.http.get(`${this.apiUrl}/cotizaciones`)}createQuote(n){return this.http.post(`${this.apiUrl}/guardar-cotizacion`,n)}updateQuote(n){return this.http.post(`${this.apiUrl}/guardar-cotizacion`,n)}deleteQuote(n){return this.http.delete(`${this.apiUrl}/eliminar-cotizacion/${n}`)}getQuoteById(n){return this.http.get(`${this.apiUrl}/cotizacion/${n}`)}getEstatus(){return this.http.get(`${this.apiUrl}/estatus`)}};a.\u0275fac=function(i){return new(i||a)(J(ot))},a.\u0275prov=G({token:a,factory:a.\u0275fac,providedIn:"root"});let e=a;return e})();var Jt=()=>[5,10,20];function Kt(e,a){if(e&1){let l=E();o(0,"button",10),x("click",function(){g(l);let i=_();return v(i.addQuote())}),s(1,"mat-icon",11),o(2,"span",12),r(3,"Agregar Cotizaci\xF3n"),t()()}}function Wt(e,a){e&1&&(o(0,"th",29),r(1," ID "),t())}function Xt(e,a){if(e&1&&(o(0,"td",30),r(1),t()),e&2){let l=a.$implicit;d(),C(" ",l.cotizacionId," ")}}function Yt(e,a){e&1&&(o(0,"th",29),r(1," Cliente "),t())}function Zt(e,a){if(e&1&&(o(0,"td",30),r(1),t()),e&2){let l=a.$implicit;d(),C(" ",l.cliente," ")}}function te(e,a){e&1&&(o(0,"th",29),r(1," Empresa "),t())}function ee(e,a){if(e&1&&(o(0,"td",30),r(1),t()),e&2){let l=a.$implicit;d(),C(" ",l.empresa," ")}}function ie(e,a){e&1&&(o(0,"th",29),r(1," Fecha Entrega "),t())}function oe(e,a){if(e&1&&(o(0,"td",30),r(1),X(2,"date"),t()),e&2){let l=a.$implicit;d(),C(" ",Y(2,1,l.fechaEntrega,"yyyy-MM-dd")," ")}}function ne(e,a){e&1&&(o(0,"th",29),r(1," Estatus "),t())}function ae(e,a){if(e&1&&(o(0,"td",30),r(1),t()),e&2){let l=a.$implicit;d(),C(" ",l.estatus," ")}}function re(e,a){e&1&&(o(0,"th",31),r(1," Acciones "),t())}function me(e,a){if(e&1){let l=E();o(0,"button",34),x("click",function(){g(l);let i=_().$implicit,m=_(2);return v(m.editQuote(i.cotizacionId))}),r(1,"Editar"),t()}}function le(e,a){if(e&1){let l=E();o(0,"button",35),x("click",function(){g(l);let i=_().$implicit,m=_(2);return v(m.deleteQuote(i.cotizacionId))}),r(1,"Eliminar"),t()}}function se(e,a){if(e&1&&(o(0,"td",30),f(1,me,2,0,"button",32)(2,le,2,0,"button",33),t()),e&2){let l=_(2);d(),c("ngIf",l.tienePermiso("btnEdit")),d(),c("ngIf",l.tienePermiso("btnDelete"))}}function de(e,a){e&1&&s(0,"tr",36)}function ue(e,a){e&1&&s(0,"tr",37)}function ce(e,a){if(e&1){let l=E();o(0,"div",13)(1,"mat-form-field",14)(2,"mat-label"),r(3,"Buscar"),t(),o(4,"input",15),x("keyup",function(i){g(l);let m=_();return v(m.applyFilter(i))}),t()(),o(5,"table",16),b(6,17),f(7,Wt,2,0,"th",18)(8,Xt,2,1,"td",19),S(),b(9,20),f(10,Yt,2,0,"th",18)(11,Zt,2,1,"td",19),S(),b(12,21),f(13,te,2,0,"th",18)(14,ee,2,1,"td",19),S(),b(15,22),f(16,ie,2,0,"th",18)(17,oe,3,4,"td",19),S(),b(18,23),f(19,ne,2,0,"th",18)(20,ae,2,1,"td",19),S(),b(21,24),f(22,re,2,0,"th",25)(23,se,3,2,"td",19),S(),f(24,de,1,0,"tr",26)(25,ue,1,0,"tr",27),t(),s(26,"mat-paginator",28),t()}if(e&2){let l=_();d(5),c("dataSource",l.dataSource),d(19),c("matHeaderRowDef",l.displayedColumns),d(),c("matRowDefColumns",l.displayedColumns),d(),c("pageSizeOptions",W(4,Jt))}}function pe(e,a){e&1&&(o(0,"div",38),r(1," Sin Cotizaciones "),t())}var Bt=(()=>{let a=class a{constructor(n,i,m,p){this.quotesService=n,this.router=i,this.snackBar=m,this.route=p,this.displayedColumns=["cotizacionId","cliente","empresa","fechaEntrega","estatus","actions"],this.dataSource=new O,this.quotesCount=0,this.searchText="",this.permisosUsuario=[],this.vistaActual="",this.permisosDisponibles=[]}ngOnInit(){this.vistaActual=this.router.url,this.getQuotes(),this.obtenerPermisos()}ngAfterViewInit(){this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}getQuotes(){this.quotesService.getQuotes().subscribe(n=>{this.quotesCount=n.length,this.dataSource=new O(n),this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort})}applyFilter(n){this.dataSource.filter=n.target.value.trim().toLowerCase()}addQuote(){this.router.navigate(["/dashboards/quote/new"])}editQuote(n){this.router.navigate([`/dashboards/quote/${n}`])}deleteQuote(n){this.quotesService.deleteQuote(n).subscribe(()=>{this.getQuotes(),this.snackBar.open("Cotizacion eliminada correctamente","Cerrar",{duration:3e3})})}obtenerPermisos(){let n=localStorage.getItem("userInformation");if(!n){console.warn("No se encontr\xF3 informaci\xF3n de usuario en localStorage.");return}let i=JSON.parse(n);console.log("vista actual ",this.vistaActual),console.log("permisos  ",i.permisos),this.permisosUsuario=i.permisos.filter(m=>m.vista.ruta===`${this.vistaActual}`),this.permisosDisponibles=this.permisosUsuario.map(m=>m.codigo),console.log("Permisos de esta vista:",this.permisosDisponibles)}tienePermiso(n){return this.permisosDisponibles.includes(n)}};a.\u0275fac=function(i){return new(i||a)(h(j),h(F),h(zt),h(D))},a.\u0275cmp=y({type:a,selectors:[["app-quotes-list"]],viewQuery:function(i,m){if(i&1&&(B($,5),B(P,5)),i&2){let p;U(p=A())&&(m.paginator=p.first),U(p=A())&&(m.sort=p.first)}},standalone:!0,features:[Q],decls:14,vars:4,consts:[["noQuotes",""],[1,"absolute","inset-0","flex","min-w-0","flex-col","overflow-hidden"],[1,"flex-auto"],[1,"flex","flex-auto","flex-col","justify-between","border-b","px-6","py-8","sm:flex-row","md:flex-col","md:px-8"],[1,"text-4xl","font-extrabold","leading-none","tracking-tight"],[1,"text-secondary","ml-0.5","font-medium"],[1,"mt-4","flex","items-center","sm:mt-0","md:mt-4"],["class","ml-4","mat-flat-button","","color","primary",3,"click",4,"ngIf"],[1,"relative"],["class","mat-elevation-z8",4,"ngIf","ngIfElse"],["mat-flat-button","","color","primary",1,"ml-4",3,"click"],["svgIcon","heroicons_outline:plus"],[1,"ml-2","mr-1"],[1,"mat-elevation-z8"],[1,"w-full"],["matInput","","placeholder","Filtrar Cotizaciones",3,"keyup"],["mat-table","","matSort","",1,"w-full",3,"dataSource"],["matColumnDef","cotizacionId"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","cliente"],["matColumnDef","empresa"],["matColumnDef","fechaEntrega"],["matColumnDef","estatus"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","",3,"pageSizeOptions"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell",""],["mat-button","","color","accent",3,"click",4,"ngIf"],["mat-button","","color","warn",3,"click",4,"ngIf"],["mat-button","","color","accent",3,"click"],["mat-button","","color","warn",3,"click"],["mat-header-row",""],["mat-row",""],[1,"border-t","p-8","text-center","text-4xl","font-semibold","tracking-tight","sm:p-16"]],template:function(i,m){if(i&1&&(o(0,"div",1)(1,"div",2)(2,"div",3)(3,"div")(4,"div",4),r(5," Cotizaciones "),t(),o(6,"div",5),r(7),t()(),o(8,"div",6),f(9,Kt,4,0,"button",7),t()(),o(10,"div",8),f(11,ce,27,5,"div",9)(12,pe,2,0,"ng-template",null,0,Z),t()()()),i&2){let p=I(13);d(7),C(" ",m.quotesCount>0?m.quotesCount:"No Cotizaciones"," "),d(2),c("ngIf",m.tienePermiso("btnAdd")),d(2),c("ngIf",m.quotesCount>0)("ngIfElse",p)}},dependencies:[w,et,it,Dt,vt,bt,Mt,St,xt,yt,Et,It,Qt,wt,z,T,lt,mt,kt,$,Tt,P,Nt,N,k,L,V,q,R],encapsulation:2});let e=a;return e})();function fe(e,a){if(e&1&&(o(0,"mat-option",32),r(1),t()),e&2){let l=a.$implicit;c("value",l.id),d(),K(l.nombre)}}var H=(()=>{let a=class a{constructor(n,i,m,p){this.fb=n,this.quotesService=i,this.route=m,this.router=p,this.estatus=[],this.unidadesDeNegocio=[],this.quotesId=null}ngOnInit(){this.quotesForm=this.fb.group({cotizacionId:[0],cliente:["",u.required],usuarioCreadorId:[0,u.required],necesidad:["",[u.required,u.maxLength(500)]],direccion:["",[u.maxLength(255)]],nombreContacto:["",[u.maxLength(255)]],telefono:["",[u.maxLength(50)]],empresa:["",[u.maxLength(255)]],cotizacion:["",[u.maxLength(255)]],ordenCompra:["",[u.maxLength(255)]],contrato:["",[u.maxLength(255)]],proveedor:["",[u.maxLength(255)]],vendedor:["",[u.maxLength(255)]],fechaEntrega:[null],rutaCritica:["",[u.maxLength(500)]],factura:["",[u.maxLength(255)]],pago:[null,u.pattern(/^\d+(\.\d{1,2})?$/)],utilidadProgramada:[null,u.pattern(/^\d+(\.\d{1,2})?$/)],utilidadReal:[null,u.pattern(/^\d+(\.\d{1,2})?$/)],financiamiento:[null,u.pattern(/^\d+(\.\d{1,2})?$/)],fechaRegistro:[new Date],estatus:[0,[u.maxLength(50)]]}),this.getEstatus();let n=JSON.parse(this.quotesService.userInformation);this.quotesForm.get("usuarioCreadorId").setValue(n.usuario.id),this.route.paramMap.subscribe(i=>{let m=i.get("id");console.log("id de proyecto ",i),!m||m==="new"?this.quotesId=null:(this.quotesId=Number(m),this.loadQuotes(this.quotesId))})}getEstatus(){this.quotesService.getEstatus().subscribe(n=>this.estatus=n)}loadQuotes(n){this.quotesService.getQuoteById(n).subscribe(i=>{i&&this.quotesForm.patchValue({cotizacionId:i.cotizacionId,cliente:i.cliente,usuarioCreadorId:i.usuarioCreadorId,necesidad:i.necesidad,direccion:i.direccion,nombreContacto:i.nombreContacto,telefono:i.telefono,empresa:i.empresa,cotizacion:i.cotizacion,ordenCompra:i.ordenCompra,contrato:i.contrato,proveedor:i.proveedor,vendedor:i.vendedor,fechaEntrega:i.fechaEntrega,rutaCritica:i.rutaCritica,factura:i.factura,pago:i.pago,utilidadProgramada:i.utilidadProgramada,utilidadReal:i.utilidadReal,financiamiento:i.financiamiento,fechaRegistro:i.fechaRegistro,estatus:i.estatus})})}saveQuotes(){if(console.log("guardar cotizaci\xF3n",this.quotesForm),this.quotesForm.invalid)return;let n=this.quotesForm.value;console.log("data de quote ",n),this.quotesId?(n.cotizacionId=this.quotesId,this.quotesService.updateQuote(n).subscribe(()=>{this.router.navigate(["/dashboards/quote"])})):this.quotesService.createQuote(n).subscribe(()=>{this.router.navigate(["/dashboards/quote"])})}};a.\u0275fac=function(i){return new(i||a)(h(Ct),h(j),h(D),h(F))},a.\u0275cmp=y({type:a,selectors:[["app-quotes-details"]],standalone:!0,features:[Q],decls:97,vars:7,consts:[["picker1",""],["picker2",""],[1,"absolute","inset-0","flex","flex-col","overflow-hidden","p-6"],[1,"text-2xl","font-bold","mb-4"],[1,"flex","flex-col","gap-4","overflow-auto",3,"ngSubmit","formGroup"],["appearance","fill",1,"w-full"],["matInput","","formControlName","cliente"],["matInput","","formControlName","nombreContacto"],["matInput","","formControlName","telefono"],["matInput","","formControlName","empresa"],["matInput","","formControlName","cotizacion"],["matInput","","formControlName","necesidad"],["matInput","","formControlName","direccion"],["matInput","","formControlName","ordenCompra"],["matInput","","formControlName","contrato"],["matInput","","formControlName","proveedor"],["matInput","","formControlName","vendedor"],[1,"grid","grid-cols-2","gap-4"],["matInput","","formControlName","fechaEntrega",3,"matDatepicker"],["matSuffix","",3,"for"],["matInput","","formControlName","fechaRegistro","disabled","",3,"matDatepicker"],["matInput","","formControlName","rutaCritica"],["matInput","","formControlName","factura"],["matInput","","type","number","formControlName","pago"],["matInput","","type","number","formControlName","utilidadProgramada"],["matInput","","type","number","formControlName","utilidadReal"],["matInput","","type","number","formControlName","financiamiento"],["formControlName","estatus"],[3,"value",4,"ngFor","ngForOf"],[1,"sticky","bottom-0","py-2","flex","justify-end","gap-2"],["mat-raised-button","","color","primary","type","submit"],["mat-button","","color","warn","type","button",3,"click"],[3,"value"]],template:function(i,m){if(i&1){let p=E();o(0,"div",2)(1,"h1",3),r(2),t(),o(3,"form",4),x("ngSubmit",function(){return g(p),v(m.saveQuotes())}),o(4,"mat-form-field",5)(5,"mat-label"),r(6,"Cliente"),t(),s(7,"input",6),t(),o(8,"mat-form-field",5)(9,"mat-label"),r(10,"Nombre de Contacto"),t(),s(11,"input",7),t(),o(12,"mat-form-field",5)(13,"mat-label"),r(14,"Tel\xE9fono"),t(),s(15,"input",8),t(),o(16,"mat-form-field",5)(17,"mat-label"),r(18,"Empresa"),t(),s(19,"input",9),t(),o(20,"mat-form-field",5)(21,"mat-label"),r(22,"Cotizaci\xF3n"),t(),s(23,"input",10),t(),o(24,"mat-form-field",5)(25,"mat-label"),r(26,"Necesidad"),t(),s(27,"textarea",11),t(),o(28,"mat-form-field",5)(29,"mat-label"),r(30,"Direcci\xF3n"),t(),s(31,"input",12),t(),o(32,"mat-form-field",5)(33,"mat-label"),r(34,"Orden de Compra"),t(),s(35,"input",13),t(),o(36,"mat-form-field",5)(37,"mat-label"),r(38,"Contrato"),t(),s(39,"input",14),t(),o(40,"mat-form-field",5)(41,"mat-label"),r(42,"Proveedor"),t(),s(43,"input",15),t(),o(44,"mat-form-field",5)(45,"mat-label"),r(46,"Vendedor"),t(),s(47,"input",16),t(),o(48,"div",17)(49,"mat-form-field",5)(50,"mat-label"),r(51,"Fecha de Entrega"),t(),s(52,"input",18)(53,"mat-datepicker-toggle",19)(54,"mat-datepicker",null,0),t(),o(56,"mat-form-field",5)(57,"mat-label"),r(58,"Fecha de Registro"),t(),s(59,"input",20)(60,"mat-datepicker-toggle",19)(61,"mat-datepicker",null,1),t()(),o(63,"mat-form-field",5)(64,"mat-label"),r(65,"Ruta Cr\xEDtica"),t(),s(66,"textarea",21),t(),o(67,"mat-form-field",5)(68,"mat-label"),r(69,"Factura"),t(),s(70,"input",22),t(),o(71,"mat-form-field",5)(72,"mat-label"),r(73,"Pago"),t(),s(74,"input",23),t(),o(75,"mat-form-field",5)(76,"mat-label"),r(77,"Utilidad Programada"),t(),s(78,"input",24),t(),o(79,"mat-form-field",5)(80,"mat-label"),r(81,"Utilidad Real"),t(),s(82,"input",25),t(),o(83,"mat-form-field",5)(84,"mat-label"),r(85,"Financiamiento"),t(),s(86,"input",26),t(),o(87,"mat-form-field",5)(88,"mat-label"),r(89,"Estatus"),t(),o(90,"mat-select",27),f(91,fe,2,2,"mat-option",28),t()(),o(92,"div",29)(93,"button",30),r(94,"Guardar"),t(),o(95,"button",31),x("click",function(){return g(p),v(m.router.navigate(["/dashboards/quote"]))}),r(96,"Cancelar"),t()()()()}if(i&2){let p=I(55),M=I(62);d(2),C(" ",m.quotesId?"Editar Cotizaci\xF3n":"Nueva Cotizaci\xF3n"," "),d(),c("formGroup",m.quotesForm),d(49),c("matDatepicker",p),d(),c("for",p),d(6),c("matDatepicker",M),d(),c("for",M),d(31),c("ngForOf",m.estatus)}},dependencies:[w,tt,gt,pt,dt,ft,ut,ct,ht,_t,R,N,k,L,rt,V,q,Lt,Ft,at,z,T,$t,Rt,qt,Vt,nt],encapsulation:2});let e=a;return e})();var Je=[{path:"",component:Bt},{path:"new",component:H},{path:":id",component:H}];export{Je as default};
