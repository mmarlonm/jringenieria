import{a as O,b as Tt,c as H,d as kt,e as Lt}from"./chunk-MSN6YMAT.js";import{a as U}from"./chunk-KY3NGPN2.js";import{a as ht,b as vt,c as xt,d as gt,e as bt,f as St,g as It,h as Mt,i as Et,j as yt,k as wt,l as Y}from"./chunk-4MVDCV4H.js";import{a as Dt,b as Ft,f as Nt}from"./chunk-EDLSFNUB.js";import"./chunk-OXDELVB2.js";import"./chunk-D7BAGR3P.js";import{a as N,h as P,i as V,m as j,n as A}from"./chunk-S5EGDSMZ.js";import{c as st,e as v,g as ct,h as dt,k as pt,m as ut,n as ft,p as Ct,r as R,s as _t}from"./chunk-MFXYIEP5.js";import{T as ot,ba as at,ga as $,ka as B,ma as lt,na as rt}from"./chunk-GZIOB5VH.js";import"./chunk-QWI5PWUG.js";import{a as mt}from"./chunk-2MWZZXHX.js";import{e as it,f as D,j as nt,l as F,q as T,x as k,z as L}from"./chunk-N75GUXKZ.js";import{$ as K,$a as s,$b as J,Db as Q,Hb as o,Ib as i,Jb as u,Kb as x,Lb as g,Nb as I,Tb as h,Vb as _,Zb as G,_b as z,ab as C,dc as l,ea as W,fc as f,ka as y,lc as w,mc as X,tc as tt,ua as b,ub as p,va as S,vc as et,wb as d}from"./chunk-PTZSXNKB.js";import"./chunk-NEB6MB4Y.js";var q=(()=>{let n=class n{constructor(e){this.http=e,this.apiUrl=`${mt.apiUrl}/Cliente`}getClient(){return this.http.get(`${this.apiUrl}/getAll-cliente`)}createClient(e){return this.http.post(`${this.apiUrl}/save-cliente`,e)}updateClient(e){return this.http.post(`${this.apiUrl}/save-cliente`,e)}deleteClient(e){return this.http.delete(`${this.apiUrl}/delete-cliente/${e}`)}getClientById(e){return this.http.get(`${this.apiUrl}/get-cliente/${e}`)}};n.\u0275fac=function(a){return new(a||n)(W(T))},n.\u0275prov=K({token:n,factory:n.\u0275fac,providedIn:"root"});let t=n;return t})();var zt=()=>({"=0":"No clientes","=1":"cliente",other:"clientes"}),Jt=()=>[5,10,20];function Xt(t,n){if(t&1&&l(0),t&2){let r=_();f(" ",r.clientsCount," ")}}function Yt(t,n){if(t&1){let r=I();o(0,"button",10),h("click",function(){b(r);let a=_();return S(a.addClient())}),u(1,"mat-icon",11),o(2,"span",12),l(3,"Agregar Cliente"),i()()}t&2&&(d("color","primary"),s(),d("svgIcon","heroicons_outline:plus"))}function Zt(t,n){t&1&&(o(0,"th",28),l(1," ID "),i())}function Kt(t,n){if(t&1&&(o(0,"td",29),l(1),i()),t&2){let r=n.$implicit;s(),f(" ",r.clienteId," ")}}function Wt(t,n){t&1&&(o(0,"th",28),l(1," Nombre "),i())}function te(t,n){if(t&1&&(o(0,"td",29),l(1),i()),t&2){let r=n.$implicit;s(),f(" ",r.nombre," ")}}function ee(t,n){t&1&&(o(0,"th",28),l(1," Tel\xE9fono "),i())}function ie(t,n){if(t&1&&(o(0,"td",29),l(1),i()),t&2){let r=n.$implicit;s(),f(" ",r.telefono," ")}}function ne(t,n){t&1&&(o(0,"th",28),l(1," Email "),i())}function oe(t,n){if(t&1&&(o(0,"td",29),l(1),i()),t&2){let r=n.$implicit;s(),f(" ",r.email," ")}}function ae(t,n){t&1&&(o(0,"th",28),l(1," Empresa "),i())}function le(t,n){if(t&1&&(o(0,"td",29),l(1),i()),t&2){let r=n.$implicit;s(),f(" ",r.empresa," ")}}function re(t,n){t&1&&(o(0,"th",30),l(1," Acciones "),i())}function me(t,n){if(t&1){let r=I();o(0,"button",33),h("click",function(){b(r);let a=_().$implicit,m=_(2);return S(m.editClient(a.clienteId))}),l(1,"Editar"),i()}}function se(t,n){if(t&1){let r=I();o(0,"button",34),h("click",function(){b(r);let a=_().$implicit,m=_(2);return S(m.deleteClient(a.clienteId))}),l(1,"Eliminar"),i()}}function ce(t,n){if(t&1&&(o(0,"td",29),p(1,me,2,0,"button",31)(2,se,2,0,"button",32),i()),t&2){let r=_(2);s(),d("ngIf",r.tienePermiso("btnEdit")),s(),d("ngIf",r.tienePermiso("btndelete"))}}function de(t,n){t&1&&u(0,"tr",35)}function pe(t,n){t&1&&u(0,"tr",36)}function ue(t,n){if(t&1){let r=I();o(0,"div",8)(1,"mat-form-field",13)(2,"mat-label"),l(3,"Buscar"),i(),o(4,"input",14),h("keyup",function(a){b(r);let m=_();return S(m.applyFilter(a))}),i()(),o(5,"table",15),x(6,16),p(7,Zt,2,0,"th",17)(8,Kt,2,1,"td",18),g(),x(9,19),p(10,Wt,2,0,"th",17)(11,te,2,1,"td",18),g(),x(12,20),p(13,ee,2,0,"th",17)(14,ie,2,1,"td",18),g(),x(15,21),p(16,ne,2,0,"th",17)(17,oe,2,1,"td",18),g(),x(18,22),p(19,ae,2,0,"th",17)(20,le,2,1,"td",18),g(),x(21,23),p(22,re,2,0,"th",24)(23,ce,3,2,"td",18),g(),p(24,de,1,0,"tr",25)(25,pe,1,0,"tr",26),i(),u(26,"mat-paginator",27),i()}if(t&2){let r=_();s(5),d("dataSource",r.dataSource),s(19),d("matHeaderRowDef",r.displayedColumns),s(),d("matRowDefColumns",r.displayedColumns),s(),d("pageSizeOptions",X(4,Jt))}}function fe(t,n){t&1&&(o(0,"div",9),l(1," Sin clientes "),i())}var $t=(()=>{let n=class n{constructor(e,a,m,c){this.clientsService=e,this.router=a,this.snackBar=m,this.route=c,this.displayedColumns=["clienteId","nombre","telefono","email","empresa","acciones"],this.dataSource=new Y,this.clientsCount=0,this.searchText="",this.permisosUsuario=[],this.vistaActual="",this.permisosDisponibles=[]}ngOnInit(){this.vistaActual=this.router.url,this.getClients(),this.obtenerPermisos()}ngAfterViewInit(){this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}getClients(){this.clientsService.getClient().subscribe(e=>{this.clientsCount=e.length,this.dataSource=new Y(e),this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort})}applyFilter(e){this.dataSource.filter=e.target.value.trim().toLowerCase()}addClient(){this.router.navigate(["/catalogs/clients/new"])}editClient(e){this.router.navigate([`/catalogs/clients/${e}`])}deleteClient(e){this.clientsService.deleteClient(e).subscribe(()=>{this.getClients(),this.snackBar.open("Cliente eliminado correctamente","Cerrar",{duration:3e3})})}obtenerPermisos(){let e=localStorage.getItem("userInformation");if(!e){console.warn("No se encontr\xF3 informaci\xF3n de usuario en localStorage.");return}let a=JSON.parse(e);console.log("Vista actual:",this.vistaActual),console.log("Permisos:",a.permisos),this.permisosUsuario=a.permisos.filter(m=>m.vista.ruta===this.vistaActual),this.permisosDisponibles=this.permisosUsuario.map(m=>m.codigo),console.log("Permisos de esta vista:",this.permisosDisponibles)}tienePermiso(e){return this.permisosDisponibles.includes(e)}};n.\u0275fac=function(a){return new(a||n)(C(q),C(L),C(U),C(k))},n.\u0275cmp=y({type:n,selectors:[["app-clients-list"]],viewQuery:function(a,m){if(a&1&&(G(O,5),G(H,5)),a&2){let c;z(c=J())&&(m.paginator=c.first),z(c=J())&&(m.sort=c.first)}},standalone:!0,features:[w],decls:15,vars:8,consts:[[1,"absolute","inset-0","flex","min-w-0","flex-col","overflow-hidden"],[1,"flex-auto"],[1,"flex","flex-auto","flex-col","justify-between","border-b","px-6","py-8","sm:flex-row","md:flex-col","md:px-8"],[1,"text-4xl","font-extrabold","leading-none","tracking-tight"],[1,"text-secondary","ml-0.5","font-medium"],[1,"mt-4","flex","items-center","sm:mt-0","md:mt-4"],["class","ml-4","mat-flat-button","",3,"color","click",4,"ngIf"],[1,"relative"],[1,"mat-elevation-z8"],[1,"border-t","p-8","text-center","text-4xl","font-semibold","tracking-tight","sm:p-16"],["mat-flat-button","",1,"ml-4",3,"click","color"],[3,"svgIcon"],[1,"ml-2","mr-1"],[1,"w-full"],["matInput","","placeholder","Filtrar clientes",3,"keyup"],["mat-table","","matSort","",1,"w-full",3,"dataSource"],["matColumnDef","clienteId"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","nombre"],["matColumnDef","telefono"],["matColumnDef","email"],["matColumnDef","empresa"],["matColumnDef","acciones"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","",3,"pageSizeOptions"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell",""],["mat-button","","color","accent",3,"click",4,"ngIf"],["mat-button","","color","warn",3,"click",4,"ngIf"],["mat-button","","color","accent",3,"click"],["mat-button","","color","warn",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(a,m){a&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"div")(4,"div",3),l(5," Clientes "),i(),o(6,"div",4),p(7,Xt,1,1),l(8),tt(9,"i18nPlural"),i()(),o(10,"div",5),p(11,Yt,4,2,"button",6),i()(),o(12,"div",7),p(13,ue,27,5,"div",8)(14,fe,2,0,"div",9),i()()()),a&2&&(s(7),Q(m.clientsCount>0?7:-1),s(),f(" ",et(9,4,m.clientsCount,X(7,zt))," "),s(3),d("ngIf",m.tienePermiso("btnAdd")),s(2),Q(m.clientsCount>0?13:14))},dependencies:[F,D,nt,wt,ht,xt,It,gt,vt,Mt,bt,St,Et,yt,B,$,rt,lt,Tt,O,Lt,H,kt,V,P,N,A,j,R],encapsulation:2});let t=n;return t})();function Ce(t,n){if(t&1&&(o(0,"mat-option",21),l(1),i()),t&2){let r,e,a=_();d("value",(r=a.clienteForm.get("colonia"))==null?null:r.value),s(),f(" ",(e=a.clienteForm.get("colonia"))==null?null:e.value," ")}}function _e(t,n){if(t&1&&(o(0,"mat-option",21),l(1),i()),t&2){let r=n.$implicit;d("value",r),s(),f(" ",r," ")}}function he(t,n){if(t&1&&(o(0,"mat-option",21),l(1),i()),t&2){let r=n.$implicit;d("value",r),s(),f(" ",r," ")}}var Z=(()=>{let n=class n{constructor(e,a,m,c,M,E){this.fb=e,this.clientsService=a,this.route=m,this.router=c,this.http=M,this.snackBar=E,this.categorias=[],this.unidadesDeNegocio=[],this.clientId=null,this.asentamientos=[],this.estadosMexico=["Aguascalientes","Baja California","Baja California Sur","Campeche","Chiapas","Chihuahua","Coahuila","Colima","Durango","Guanajuato","Guerrero","Hidalgo","Jalisco","M\xE9xico","Michoac\xE1n","Morelos","Nayarit","Nuevo Le\xF3n","Oaxaca","Puebla","Quer\xE9taro","Quintana Roo","San Luis Potos\xED","Sinaloa","Sonora","Tabasco","Tamaulipas","Tlaxcala","Veracruz","Yucat\xE1n","Zacatecas"]}ngOnInit(){this.clienteForm=this.fb.group({clienteId:[0],nombre:["",v.required],direccion:[""],ciudad:[""],colonia:[""],estado:[""],pais:["M\xE9xico",v.required],codigoPostal:["",[v.required,v.pattern(/^\d{5}$/)]],telefono:["",v.required],email:["",[v.required,v.email]],empresa:[""],rfc:[""],activo:[!0]}),this.route.paramMap.subscribe(e=>{let a=e.get("id");a==="new"?this.clientId=null:(this.clientId=Number(a),this.loadClient(this.clientId))})}getCategorias(){this.clientsService.getClient().subscribe(e=>this.categorias=e)}loadClient(e){this.clientsService.getClientById(e).subscribe(a=>{a&&this.clienteForm.patchValue(a)})}saveClient(){if(this.clienteForm.invalid)return;let e=this.clienteForm.value;console.log("data de proyecto ",e),this.clientId?(e.proyectoId=this.clientId,this.clientsService.updateClient(e).subscribe(()=>{this.router.navigate(["/catalogs/clients"])})):this.clientsService.updateClient(e).subscribe(()=>{this.router.navigate(["/catalogs/clients"])})}buscarDireccionPorCP(){let e=this.clienteForm.get("codigoPostal")?.value;if(!e||e.length!==5)return;let m=`https://api.copomex.com/query/info_cp/${e}?token=5f76a85b-d1a1-47ce-8e81-3de0df42e11c`;this.http.get(m).subscribe(c=>{if(c.length>0){console.log("Respuesta de COPOMEX:",c);let M=c[0].response,E=M.estado,Bt=M.ciudad,Rt=c.map(jt=>jt.response.asentamiento);this.estadosMexico.includes(E)?(this.clienteForm.patchValue({ciudad:Bt,estado:E,pais:"M\xE9xico"}),this.asentamientos=Rt):this.snackBar.open("El estado recibido no es v\xE1lido para M\xE9xico","Cerrar",{duration:3e3})}else this.snackBar.open("No se encontraron datos para este c\xF3digo postal","Cerrar",{duration:3e3})},()=>{this.snackBar.open("Error al obtener datos del c\xF3digo postal","Cerrar",{duration:3e3})})}};n.\u0275fac=function(a){return new(a||n)(C(Ct),C(q),C(k),C(L),C(T),C(U))},n.\u0275cmp=y({type:n,selectors:[["app-clients-details"]],standalone:!0,features:[w],decls:60,vars:5,consts:[[1,"absolute","inset-0","flex","flex-col","overflow-hidden","p-6"],[1,"text-2xl","font-bold","mb-4"],[1,"flex","flex-col","gap-4","overflow-auto",3,"ngSubmit","formGroup"],["appearance","fill",1,"w-full"],["matInput","","formControlName","nombre"],["matInput","","formControlName","direccion"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],["matInput","","formControlName","ciudad"],["formControlName","colonia"],[3,"value",4,"ngIf"],[3,"value",4,"ngFor","ngForOf"],["formControlName","estado"],["matInput","","formControlName","pais","disabled","","value","M\xE9xico"],["matInput","","formControlName","codigoPostal",3,"blur"],["matInput","","formControlName","telefono"],["matInput","","type","email","formControlName","email"],["matInput","","formControlName","empresa"],["matInput","","formControlName","rfc"],[1,"sticky","bottom-0","py-2","flex","justify-end","gap-2"],["mat-raised-button","","color","primary","type","submit",1,"w-full","md:w-auto"],["mat-button","","color","warn","type","button",3,"click"],[3,"value"]],template:function(a,m){if(a&1&&(o(0,"div",0)(1,"h1",1),l(2),i(),o(3,"form",2),h("ngSubmit",function(){return m.saveClient()}),o(4,"mat-form-field",3)(5,"mat-label"),l(6,"Nombre"),i(),u(7,"input",4),i(),o(8,"mat-form-field",3)(9,"mat-label"),l(10,"Direcci\xF3n"),i(),u(11,"input",5),i(),o(12,"div",6)(13,"mat-form-field",3)(14,"mat-label"),l(15,"Ciudad"),i(),u(16,"input",7),i(),o(17,"mat-form-field",3)(18,"mat-label"),l(19,"Colonia"),i(),o(20,"mat-select",8),p(21,Ce,2,2,"mat-option",9)(22,_e,2,2,"mat-option",10),i()()(),o(23,"mat-form-field",3)(24,"mat-label"),l(25,"Estado"),i(),o(26,"mat-select",11),p(27,he,2,2,"mat-option",10),i()(),o(28,"div",6)(29,"mat-form-field",3)(30,"mat-label"),l(31,"Pa\xEDs"),i(),u(32,"input",12),i(),o(33,"mat-form-field",3)(34,"mat-label"),l(35,"C\xF3digo Postal"),i(),o(36,"input",13),h("blur",function(){return m.buscarDireccionPorCP()}),i()()(),o(37,"div",6)(38,"mat-form-field",3)(39,"mat-label"),l(40,"Tel\xE9fono"),i(),u(41,"input",14),i(),o(42,"mat-form-field",3)(43,"mat-label"),l(44,"Email"),i(),u(45,"input",15),i()(),o(46,"div",6)(47,"mat-form-field",3)(48,"mat-label"),l(49,"Empresa"),i(),u(50,"input",16),i(),o(51,"mat-form-field",3)(52,"mat-label"),l(53,"RFC"),i(),u(54,"input",17),i()(),o(55,"div",18)(56,"button",19),l(57,"Guardar"),i(),o(58,"button",20),h("click",function(){return m.router.navigate(["/catalogs/clients"])}),l(59,"Cancelar"),i()()()()),a&2){let c;s(2),f(" ",m.clientId?"Editar Cliente":"Nuevo Cliente"," "),s(),d("formGroup",m.clienteForm),s(18),d("ngIf",!m.asentamientos.includes((c=m.clienteForm.get("colonia"))==null?null:c.value)&&((c=m.clienteForm.get("colonia"))==null?null:c.value)),s(),d("ngForOf",m.asentamientos),s(5),d("ngForOf",m.estadosMexico)}},dependencies:[F,it,D,_t,pt,st,ct,dt,ut,ft,R,V,P,N,A,j,Ft,Dt,at,B,$,Nt,ot],encapsulation:2});let t=n;return t})();var Je=[{path:"",component:$t},{path:"new",component:Z},{path:":id",component:Z}];export{Je as default};
