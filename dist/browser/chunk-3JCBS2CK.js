import{a as k}from"./chunk-WQN3REH4.js";import{a as m}from"./chunk-2MWZZXHX.js";import{q as g}from"./chunk-N75GUXKZ.js";import{$ as f,U as d,fa as l,l as i,m as p}from"./chunk-PTZSXNKB.js";import{d as h}from"./chunk-NEB6MB4Y.js";var u=class{static isTokenExpired(t,r){if(!t||t==="")return!0;let e=this._getTokenExpirationDate(t);return r=r||0,e===null?!0:!(e.valueOf()>new Date().valueOf()+r*1e3)}static _b64decode(t){let r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e="";if(t=String(t).replace(/=+$/,""),t.length%4===1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(let o=0,a,s,c=0;s=t.charAt(c++);~s&&(a=o%4?a*64+s:s,o++%4)?e+=String.fromCharCode(255&a>>(-2*o&6)):0)s=r.indexOf(s);return e}static _b64DecodeUnicode(t){return decodeURIComponent(Array.prototype.map.call(this._b64decode(t),r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join(""))}static _urlBase64Decode(t){let r=t.replace(/-/g,"+").replace(/_/g,"/");switch(r.length%4){case 0:break;case 2:{r+="==";break}case 3:{r+="=";break}default:throw Error("Illegal base64url string!")}return this._b64DecodeUnicode(r)}static _decodeToken(t){if(!t)return null;let r=t.split(".");if(r.length!==3)throw new Error("The inspected token doesn't appear to be a JWT. Check to make sure it has three parts and see https://jwt.io for more.");let e=this._urlBase64Decode(r[1]);if(!e)throw new Error("Cannot decode the token.");return JSON.parse(e)}static _getTokenExpirationDate(t){let r=this._decodeToken(t);if(!r.hasOwnProperty("exp"))return null;let e=new Date(0);return e.setUTCSeconds(r.exp),e}};var U=(()=>{let t=class t{constructor(){this.apiUrl=`${m.apiUrl}/Auth`,this._authenticated=!1,this._httpClient=l(g),this._userService=l(k)}set accessToken(e){localStorage.setItem("accessToken",e)}get accessToken(){return localStorage.getItem("accessToken")??""}set userInformation(e){localStorage.setItem("userInformation",e)}get userInformation(){return localStorage.getItem("userInformation")??""}forgotPassword(e){return this._httpClient.post("api/auth/forgot-password",e)}resetPassword(e){return this._httpClient.post("api/auth/reset-password",e)}signIn(e){return this._authenticated?p("User is already logged in."):this._httpClient.post(`${this.apiUrl}/login`,e).pipe(d(o=>{console.log("respuesta login ",o),this.accessToken=o.token,this._authenticated=!0;let c=o,{token:a}=c,s=h(c,["token"]);return this.userInformation=JSON.stringify(s),this._userService.user=o,i(o)}))}signOut(){return localStorage.removeItem("accessToken"),localStorage.removeItem("userInformation"),this._authenticated=!1,i(!0)}signUp(e){return this._httpClient.post("api/auth/sign-up",e)}unlockSession(e){return this._httpClient.post("api/auth/unlock-session",e)}check(){if(this._authenticated)return i(!0);if(!this.accessToken)return i(!1);if(u.isTokenExpired(this.accessToken))return i(!1);let e=JSON.parse(this.userInformation);return this._userService.user=e,i(!0)}};t.\u0275fac=function(o){return new(o||t)},t.\u0275prov=f({token:t,factory:t.\u0275fac,providedIn:"root"});let n=t;return n})();export{u as a,U as b};
