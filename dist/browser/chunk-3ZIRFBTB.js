import{a as U,b as Rt,c as j,d as $t,e as Pt}from"./chunk-MSN6YMAT.js";import{a as Bt}from"./chunk-KY3NGPN2.js";import{a as yt,b as Mt,c as wt,d as Qt,e as Dt,f as Ft,g as kt,h as Lt,i as Vt,j as Nt,k as Tt,l as J}from"./chunk-4MVDCV4H.js";import{a as zt,b as qt,c as Ut,d as jt,e as At,f as Ot}from"./chunk-EDLSFNUB.js";import"./chunk-OXDELVB2.js";import"./chunk-D7BAGR3P.js";import{a as N,d as pt,h as T,i as z,m as P,n as B}from"./chunk-S5EGDSMZ.js";import{c as gt,e as p,g as vt,h as Ct,k as xt,m as bt,n as St,p as Et,r as $,s as It}from"./chunk-MFXYIEP5.js";import{T as dt,ba as ct,ga as q,ka as R,ma as ft,na as _t}from"./chunk-GZIOB5VH.js";import"./chunk-QWI5PWUG.js";import{a as ht}from"./chunk-2MWZZXHX.js";import{e as mt,f as lt,i as ut,l as k,q as st,x as L,z as V}from"./chunk-N75GUXKZ.js";import{$ as tt,$a as l,$b as G,Hb as o,Ib as t,Jb as c,Kb as E,Lb as I,Nb as y,Tb as g,Vb as x,Zb as O,_b as H,ab as C,cc as w,dc as r,ea as et,ec as nt,fc as b,ka as D,lc as F,mc as ot,na as it,tc as M,ua as _,ub as f,uc as Q,va as h,vc as at,wb as d,wc as rt}from"./chunk-PTZSXNKB.js";import"./chunk-NEB6MB4Y.js";var A=(()=>{let a=class a{constructor(n){this.http=n,this.apiUrl=`${ht.apiUrl}/Cotizacion`}get userInformation(){return localStorage.getItem("userInformation")??""}getQuotes(){return this.http.get(`${this.apiUrl}/cotizaciones`)}createQuote(n){return this.http.post(`${this.apiUrl}/guardar-cotizacion`,n)}updateQuote(n){return this.http.post(`${this.apiUrl}/guardar-cotizacion`,n)}deleteQuote(n){return this.http.delete(`${this.apiUrl}/eliminar-cotizacion/${n}`)}getQuoteById(n){return this.http.get(`${this.apiUrl}/cotizacion/${n}`)}getEstatus(){return this.http.get(`${this.apiUrl}/estatus`)}};a.\u0275fac=function(i){return new(i||a)(et(st))},a.\u0275prov=tt({token:a,factory:a.\u0275fac,providedIn:"root"});let e=a;return e})();var te=()=>[5,10,20];function ee(e,a){if(e&1){let u=y();o(0,"button",10),g("click",function(){_(u);let i=x();return h(i.addQuote())}),c(1,"mat-icon",11),o(2,"span",12),r(3,"Agregar Cotizaci\xF3n"),t()()}}function ie(e,a){e&1&&(o(0,"th",29),r(1," ID "),t())}function ne(e,a){if(e&1&&(o(0,"td",30),r(1),t()),e&2){let u=a.$implicit;l(),b(" ",u.cotizacionId," ")}}function oe(e,a){e&1&&(o(0,"th",29),r(1," Cliente "),t())}function ae(e,a){if(e&1&&(o(0,"td",30),r(1),t()),e&2){let u=a.$implicit;l(),b(" ",u.cliente," ")}}function re(e,a){e&1&&(o(0,"th",29),r(1," Empresa "),t())}function me(e,a){if(e&1&&(o(0,"td",30),r(1),t()),e&2){let u=a.$implicit;l(),b(" ",u.empresa," ")}}function le(e,a){e&1&&(o(0,"th",29),r(1," Fecha Entrega "),t())}function ue(e,a){if(e&1&&(o(0,"td",30),r(1),M(2,"date"),t()),e&2){let u=a.$implicit;l(),b(" ",at(2,1,u.fechaEntrega,"yyyy-MM-dd")," ")}}function se(e,a){e&1&&(o(0,"th",29),r(1," Estatus "),t())}function de(e,a){if(e&1&&(o(0,"td",30),r(1),t()),e&2){let u=a.$implicit;l(),b(" ",u.estatus," ")}}function ce(e,a){e&1&&(o(0,"th",31),r(1," Acciones "),t())}function pe(e,a){if(e&1){let u=y();o(0,"button",34),g("click",function(){_(u);let i=x().$implicit,m=x(2);return h(m.editQuote(i.cotizacionId))}),r(1,"Editar"),t()}}function fe(e,a){if(e&1){let u=y();o(0,"button",35),g("click",function(){_(u);let i=x().$implicit,m=x(2);return h(m.deleteQuote(i.cotizacionId))}),r(1,"Eliminar"),t()}}function _e(e,a){if(e&1&&(o(0,"td",30),f(1,pe,2,0,"button",32)(2,fe,2,0,"button",33),t()),e&2){let u=x(2);l(),d("ngIf",u.tienePermiso("btnEdit")),l(),d("ngIf",u.tienePermiso("btnDelete"))}}function he(e,a){e&1&&c(0,"tr",36)}function ge(e,a){e&1&&c(0,"tr",37)}function ve(e,a){if(e&1){let u=y();o(0,"div",13)(1,"mat-form-field",14)(2,"mat-label"),r(3,"Buscar"),t(),o(4,"input",15),g("keyup",function(i){_(u);let m=x();return h(m.applyFilter(i))}),t()(),o(5,"table",16),E(6,17),f(7,ie,2,0,"th",18)(8,ne,2,1,"td",19),I(),E(9,20),f(10,oe,2,0,"th",18)(11,ae,2,1,"td",19),I(),E(12,21),f(13,re,2,0,"th",18)(14,me,2,1,"td",19),I(),E(15,22),f(16,le,2,0,"th",18)(17,ue,3,4,"td",19),I(),E(18,23),f(19,se,2,0,"th",18)(20,de,2,1,"td",19),I(),E(21,24),f(22,ce,2,0,"th",25)(23,_e,3,2,"td",19),I(),f(24,he,1,0,"tr",26)(25,ge,1,0,"tr",27),t(),c(26,"mat-paginator",28),t()}if(e&2){let u=x();l(5),d("dataSource",u.dataSource),l(19),d("matHeaderRowDef",u.displayedColumns),l(),d("matRowDefColumns",u.displayedColumns),l(),d("pageSizeOptions",ot(4,te))}}function Ce(e,a){e&1&&(o(0,"div",38),r(1," Sin Cotizaciones "),t())}var Gt=(()=>{let a=class a{constructor(n,i,m,s){this.quotesService=n,this.router=i,this.snackBar=m,this.route=s,this.displayedColumns=["cotizacionId","cliente","empresa","fechaEntrega","estatus","actions"],this.dataSource=new J,this.quotesCount=0,this.searchText="",this.permisosUsuario=[],this.vistaActual="",this.permisosDisponibles=[]}ngOnInit(){this.vistaActual=this.router.url,this.getQuotes(),this.obtenerPermisos()}ngAfterViewInit(){this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}getQuotes(){this.quotesService.getQuotes().subscribe(n=>{this.quotesCount=n.length,this.dataSource=new J(n),this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort})}applyFilter(n){this.dataSource.filter=n.target.value.trim().toLowerCase()}addQuote(){this.router.navigate(["/dashboards/quote/new"])}editQuote(n){this.router.navigate([`/dashboards/quote/${n}`])}deleteQuote(n){this.quotesService.deleteQuote(n).subscribe(()=>{this.getQuotes(),this.snackBar.open("Cotizacion eliminada correctamente","Cerrar",{duration:3e3})})}obtenerPermisos(){let n=localStorage.getItem("userInformation");if(!n){console.warn("No se encontr\xF3 informaci\xF3n de usuario en localStorage.");return}let i=JSON.parse(n);console.log("vista actual ",this.vistaActual),console.log("permisos  ",i.permisos),this.permisosUsuario=i.permisos.filter(m=>m.vista.ruta===`${this.vistaActual}`),this.permisosDisponibles=this.permisosUsuario.map(m=>m.codigo),console.log("Permisos de esta vista:",this.permisosDisponibles)}tienePermiso(n){return this.permisosDisponibles.includes(n)}};a.\u0275fac=function(i){return new(i||a)(C(A),C(V),C(Bt),C(L))},a.\u0275cmp=D({type:a,selectors:[["app-quotes-list"]],viewQuery:function(i,m){if(i&1&&(O(U,5),O(j,5)),i&2){let s;H(s=G())&&(m.paginator=s.first),H(s=G())&&(m.sort=s.first)}},standalone:!0,features:[F],decls:14,vars:4,consts:[["noQuotes",""],[1,"absolute","inset-0","flex","min-w-0","flex-col","overflow-hidden"],[1,"flex-auto"],[1,"flex","flex-auto","flex-col","justify-between","border-b","px-6","py-8","sm:flex-row","md:flex-col","md:px-8"],[1,"text-4xl","font-extrabold","leading-none","tracking-tight"],[1,"text-secondary","ml-0.5","font-medium"],[1,"mt-4","flex","items-center","sm:mt-0","md:mt-4"],["class","ml-4","mat-flat-button","","color","primary",3,"click",4,"ngIf"],[1,"relative"],["class","mat-elevation-z8",4,"ngIf","ngIfElse"],["mat-flat-button","","color","primary",1,"ml-4",3,"click"],["svgIcon","heroicons_outline:plus"],[1,"ml-2","mr-1"],[1,"mat-elevation-z8"],[1,"w-full"],["matInput","","placeholder","Filtrar Cotizaciones",3,"keyup"],["mat-table","","matSort","",1,"w-full",3,"dataSource"],["matColumnDef","cotizacionId"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","cliente"],["matColumnDef","empresa"],["matColumnDef","fechaEntrega"],["matColumnDef","estatus"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","",3,"pageSizeOptions"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell",""],["mat-button","","color","accent",3,"click",4,"ngIf"],["mat-button","","color","warn",3,"click",4,"ngIf"],["mat-button","","color","accent",3,"click"],["mat-button","","color","warn",3,"click"],["mat-header-row",""],["mat-row",""],[1,"border-t","p-8","text-center","text-4xl","font-semibold","tracking-tight","sm:p-16"]],template:function(i,m){if(i&1&&(o(0,"div",1)(1,"div",2)(2,"div",3)(3,"div")(4,"div",4),r(5," Cotizaciones "),t(),o(6,"div",5),r(7),t()(),o(8,"div",6),f(9,ee,4,0,"button",7),t()(),o(10,"div",8),f(11,ve,27,5,"div",9)(12,Ce,2,0,"ng-template",null,0,rt),t()()()),i&2){let s=w(13);l(7),b(" ",m.quotesCount>0?m.quotesCount:"No Cotizaciones"," "),l(2),d("ngIf",m.tienePermiso("btnAdd")),l(2),d("ngIf",m.quotesCount>0)("ngIfElse",s)}},dependencies:[k,lt,ut,Tt,yt,wt,kt,Qt,Mt,Lt,Dt,Ft,Vt,Nt,R,q,_t,ft,Rt,U,Pt,j,$t,z,T,N,B,P,$],encapsulation:2});let e=a;return e})();var Jt=(()=>{let a=class a{transform(n){if(n==null||n==="")return"";let i=parseFloat(n.toString().replace(/,/g,""));return isNaN(i)?"":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(i)}};a.\u0275fac=function(i){return new(i||a)},a.\u0275pipe=it({name:"currencyMask",type:a,pure:!0,standalone:!0});let e=a;return e})();function xe(e,a){if(e&1&&(o(0,"mat-option",32),r(1),t()),e&2){let u=a.$implicit;d("value",u.id),l(),nt(u.nombre)}}var W=(()=>{let a=class a{constructor(n,i,m,s){this.fb=n,this.quotesService=i,this.route=m,this.router=s,this.estatus=[],this.unidadesDeNegocio=[],this.quotesId=null}ngOnInit(){this.quotesForm=this.fb.group({cotizacionId:[0],cliente:["",p.required],usuarioCreadorId:[0,p.required],necesidad:["",[p.required,p.maxLength(500)]],direccion:["",[p.maxLength(255)]],nombreContacto:["",[p.maxLength(255)]],telefono:["",[p.maxLength(50)]],empresa:["",[p.maxLength(255)]],cotizacion:["",[p.maxLength(255)]],ordenCompra:["",[p.maxLength(255)]],contrato:["",[p.maxLength(255)]],proveedor:["",[p.maxLength(255)]],vendedor:["",[p.maxLength(255)]],fechaEntrega:[null],rutaCritica:["",[p.maxLength(500)]],factura:["",[p.maxLength(255)]],pago:[null,p.pattern(/^\d+(\.\d{1,2})?$/)],utilidadProgramada:[null,p.pattern(/^\d+(\.\d{1,2})?$/)],utilidadReal:[null,p.pattern(/^\d+(\.\d{1,2})?$/)],financiamiento:[null,p.pattern(/^\d+(\.\d{1,2})?$/)],fechaRegistro:[new Date],estatus:[0,[p.maxLength(50)]]}),this.getEstatus();let n=JSON.parse(this.quotesService.userInformation);this.quotesForm.get("usuarioCreadorId").setValue(n.usuario.id),this.route.paramMap.subscribe(i=>{let m=i.get("id");console.log("id de proyecto ",i),!m||m==="new"?this.quotesId=null:(this.quotesId=Number(m),this.loadQuotes(this.quotesId))})}getEstatus(){this.quotesService.getEstatus().subscribe(n=>this.estatus=n)}loadQuotes(n){this.quotesService.getQuoteById(n).subscribe(i=>{i&&this.quotesForm.patchValue({cotizacionId:i.cotizacionId,cliente:i.cliente,usuarioCreadorId:i.usuarioCreadorId,necesidad:i.necesidad,direccion:i.direccion,nombreContacto:i.nombreContacto,telefono:i.telefono,empresa:i.empresa,cotizacion:i.cotizacion,ordenCompra:i.ordenCompra,contrato:i.contrato,proveedor:i.proveedor,vendedor:i.vendedor,fechaEntrega:i.fechaEntrega,rutaCritica:i.rutaCritica,factura:i.factura,pago:i.pago,utilidadProgramada:i.utilidadProgramada,utilidadReal:i.utilidadReal,financiamiento:i.financiamiento,fechaRegistro:i.fechaRegistro,estatus:i.estatus})})}saveQuotes(){if(console.log("guardar cotizaci\xF3n",this.quotesForm),this.quotesForm.invalid)return;let n=this.quotesForm.value;console.log("data de quote ",n),this.quotesId?(n.cotizacionId=this.quotesId,this.quotesService.updateQuote(n).subscribe(()=>{this.router.navigate(["/dashboards/quote"])})):this.quotesService.createQuote(n).subscribe(()=>{this.router.navigate(["/dashboards/quote"])})}updateValue(n,i){let s=n.target.value.replace(/[^0-9.]/g,"");this.quotesForm.get(i)?.setValue(s)}};a.\u0275fac=function(i){return new(i||a)(C(Et),C(A),C(L),C(V))},a.\u0275cmp=D({type:a,selectors:[["app-quotes-details"]],standalone:!0,features:[F],decls:110,vars:19,consts:[["picker1",""],["picker2",""],[1,"absolute","inset-0","flex","flex-col","overflow-hidden","p-6"],[1,"text-2xl","font-bold","mb-4"],[1,"flex","flex-col","gap-4","overflow-auto",3,"ngSubmit","formGroup"],[1,"grid","grid-cols-2","gap-4"],["appearance","fill",1,"w-full"],["matInput","","formControlName","cliente"],["matInput","","formControlName","nombreContacto"],["matInput","","formControlName","telefono"],["matInput","","formControlName","empresa"],["matInput","","formControlName","cotizacion"],["matInput","","formControlName","necesidad"],["matInput","","formControlName","direccion"],["matInput","","formControlName","ordenCompra"],["matInput","","formControlName","contrato"],["matInput","","formControlName","proveedor"],["matInput","","formControlName","vendedor"],["matInput","","formControlName","fechaEntrega",3,"matDatepicker"],["matSuffix","",3,"for"],["matInput","","formControlName","fechaRegistro","disabled","",3,"matDatepicker"],["matInput","","formControlName","rutaCritica"],["matInput","","formControlName","factura"],["matInput","","type","text","formControlName","pago",3,"input","value"],["matInput","","type","text","formControlName","utilidadProgramada",3,"input","value"],["matInput","","type","text","formControlName","utilidadReal",3,"input","value"],["matInput","","type","text","formControlName","financiamiento",3,"input","value"],["formControlName","estatus"],[3,"value",4,"ngFor","ngForOf"],[1,"sticky","bottom-0","py-2","flex","justify-end","gap-2"],["mat-raised-button","","color","primary","type","submit"],["mat-button","","color","warn","type","button",3,"click"],[3,"value"]],template:function(i,m){if(i&1){let s=y();o(0,"div",2)(1,"h1",3),r(2),t(),o(3,"form",4),g("ngSubmit",function(){return _(s),h(m.saveQuotes())}),o(4,"div",5)(5,"mat-form-field",6)(6,"mat-label"),r(7,"Cliente"),t(),c(8,"input",7),t(),o(9,"mat-form-field",6)(10,"mat-label"),r(11,"Nombre de Contacto"),t(),c(12,"input",8),t()(),o(13,"div",5)(14,"mat-form-field",6)(15,"mat-label"),r(16,"Tel\xE9fono"),t(),c(17,"input",9),t(),o(18,"mat-form-field",6)(19,"mat-label"),r(20,"Empresa"),t(),c(21,"input",10),t()(),o(22,"div",5)(23,"mat-form-field",6)(24,"mat-label"),r(25,"Cotizaci\xF3n"),t(),c(26,"input",11),t(),o(27,"mat-form-field",6)(28,"mat-label"),r(29,"Necesidad"),t(),c(30,"textarea",12),t()(),o(31,"div",5)(32,"mat-form-field",6)(33,"mat-label"),r(34,"Direcci\xF3n"),t(),c(35,"input",13),t(),o(36,"mat-form-field",6)(37,"mat-label"),r(38,"Orden de Compra"),t(),c(39,"input",14),t()(),o(40,"div",5)(41,"mat-form-field",6)(42,"mat-label"),r(43,"Contrato"),t(),c(44,"input",15),t(),o(45,"mat-form-field",6)(46,"mat-label"),r(47,"Proveedor"),t(),c(48,"input",16),t()(),o(49,"div",5)(50,"mat-form-field",6)(51,"mat-label"),r(52,"Vendedor"),t(),c(53,"input",17),t(),o(54,"mat-form-field",6)(55,"mat-label"),r(56,"Fecha de Entrega"),t(),c(57,"input",18)(58,"mat-datepicker-toggle",19)(59,"mat-datepicker",null,0),t(),o(61,"mat-form-field",6)(62,"mat-label"),r(63,"Fecha de Registro"),t(),c(64,"input",20)(65,"mat-datepicker-toggle",19)(66,"mat-datepicker",null,1),t()(),o(68,"div",5)(69,"mat-form-field",6)(70,"mat-label"),r(71,"Ruta Cr\xEDtica"),t(),c(72,"textarea",21),t(),o(73,"mat-form-field",6)(74,"mat-label"),r(75,"Factura"),t(),c(76,"input",22),t()(),o(77,"div",5)(78,"mat-form-field",6)(79,"mat-label"),r(80,"Pago"),t(),o(81,"input",23),M(82,"currencyMask"),g("input",function(v){return _(s),h(m.updateValue(v,"pago"))}),t()(),o(83,"mat-form-field",6)(84,"mat-label"),r(85,"Utilidad Programada"),t(),o(86,"input",24),M(87,"currencyMask"),g("input",function(v){return _(s),h(m.updateValue(v,"utilidadProgramada"))}),t()()(),o(88,"div",5)(89,"mat-form-field",6)(90,"mat-label"),r(91,"Utilidad Real"),t(),o(92,"input",25),M(93,"currencyMask"),g("input",function(v){return _(s),h(m.updateValue(v,"utilidadReal"))}),t()(),o(94,"mat-form-field",6)(95,"mat-label"),r(96,"Financiamiento"),t(),o(97,"input",26),M(98,"currencyMask"),g("input",function(v){return _(s),h(m.updateValue(v,"financiamiento"))}),t()()(),o(99,"div",5)(100,"mat-form-field",6)(101,"mat-label"),r(102,"Estatus"),t(),o(103,"mat-select",27),f(104,xe,2,2,"mat-option",28),t()()(),o(105,"div",29)(106,"button",30),r(107,"Guardar"),t(),o(108,"button",31),g("click",function(){return _(s),h(m.router.navigate(["/dashboards/quote"]))}),r(109,"Cancelar"),t()()()()}if(i&2){let s,S,v,X,Y=w(60),Z=w(67);l(2),b(" ",m.quotesId?"Editar Cotizaci\xF3n":"Nueva Cotizaci\xF3n"," "),l(),d("formGroup",m.quotesForm),l(54),d("matDatepicker",Y),l(),d("for",Y),l(6),d("matDatepicker",Z),l(),d("for",Z),l(16),d("value",Q(82,11,(s=m.quotesForm.get("pago"))==null?null:s.value)),l(5),d("value",Q(87,13,(S=m.quotesForm.get("utilidadProgramada"))==null?null:S.value)),l(6),d("value",Q(93,15,(v=m.quotesForm.get("utilidadReal"))==null?null:v.value)),l(5),d("value",Q(98,17,(X=m.quotesForm.get("financiamiento"))==null?null:X.value)),l(7),d("ngForOf",m.estatus)}},dependencies:[k,mt,It,xt,gt,vt,Ct,bt,St,$,z,T,N,pt,B,P,qt,zt,ct,R,q,Ot,Ut,jt,At,dt,Jt],encapsulation:2});let e=a;return e})();var ii=[{path:"",component:Gt},{path:"new",component:W},{path:":id",component:W}];export{ii as default};
