import{a as $,b as Fe,c as q,d as Te,e as ke}from"./chunk-MSN6YMAT.js";import{a as Le}from"./chunk-KY3NGPN2.js";import{a as be,b as ve,c as xe,d as je,e as Se,f as Ee,g as Ie,h as Pe,i as ye,j as De,k as Me,l as W}from"./chunk-4MVDCV4H.js";import{a as Ne,b as we,c as Ae,d as Re,e as Ve,f as Ue}from"./chunk-EDLSFNUB.js";import"./chunk-OXDELVB2.js";import"./chunk-D7BAGR3P.js";import{a as F,d as me,h as T,i as k,m as V,n as U}from"./chunk-S5EGDSMZ.js";import{c as de,e as S,g as pe,h as ue,k as fe,m as Ce,n as ge,p as he,r as R,s as _e}from"./chunk-MFXYIEP5.js";import{T as ae,ba as re,ga as L,ka as A,ma as le,na as ce}from"./chunk-GZIOB5VH.js";import"./chunk-QWI5PWUG.js";import{a as se}from"./chunk-2MWZZXHX.js";import{e as ee,f as te,i as ie,j as oe,l as M,q as ne,x as N,z as w}from"./chunk-N75GUXKZ.js";import{$ as Y,$a as s,$b as Q,Db as z,Hb as o,Ib as e,Jb as l,Kb as v,Lb as x,Nb as j,Tb as b,Vb as C,Zb as O,_b as H,ab as f,cc as G,dc as n,ea as Z,ec as J,fc as g,ka as I,lc as P,mc as K,tc as y,ua as h,ub as p,va as _,vc as D,wb as d}from"./chunk-PTZSXNKB.js";import"./chunk-NEB6MB4Y.js";var B=(()=>{let a=class a{constructor(r){this.http=r,this.apiUrl=`${se.apiUrl}/Proyecto`}getProjects(){return this.http.get(`${this.apiUrl}/proyectos`)}getUnidadesDeNegocio(){return this.http.get(`${this.apiUrl}/unidades-negocio`)}getCategorias(){return this.http.get(`${this.apiUrl}/categorias`)}createProject(r){return this.http.post(`${this.apiUrl}/guardar-proyecto`,r)}updateProject(r){return this.http.post(`${this.apiUrl}/guardar-proyecto`,r)}deleteProject(r){return this.http.delete(`${this.apiUrl}/eliminar-proyecto/${r}`)}getProjectById(r){return this.http.get(`${this.apiUrl}/proyecto/${r}`)}};a.\u0275fac=function(m){return new(m||a)(Z(ne))},a.\u0275prov=Y({token:a,factory:a.\u0275fac,providedIn:"root"});let i=a;return i})();var Je=()=>({"=0":"No proyectos","=1":"proyecto",other:"proyectos"}),Ke=()=>[5,10,20];function We(i,a){if(i&1&&n(0),i&2){let c=C();g(" ",c.projectsCount," ")}}function Xe(i,a){if(i&1){let c=j();o(0,"button",10),b("click",function(){h(c);let m=C();return _(m.addProject())}),l(1,"mat-icon",11),o(2,"span",12),n(3,"Agregar Proyecto"),e()()}i&2&&(d("color","primary"),s(),d("svgIcon","heroicons_outline:plus"))}function Ye(i,a){i&1&&(o(0,"th",28),n(1," ID "),e())}function Ze(i,a){if(i&1&&(o(0,"td",29),n(1),e()),i&2){let c=a.$implicit;s(),g(" ",c.proyectoId," ")}}function et(i,a){i&1&&(o(0,"th",28),n(1," Nombre "),e())}function tt(i,a){if(i&1&&(o(0,"td",29),n(1),e()),i&2){let c=a.$implicit;s(),g(" ",c.nombre," ")}}function it(i,a){i&1&&(o(0,"th",28),n(1," Categor\xEDa "),e())}function ot(i,a){if(i&1&&(o(0,"td",29),n(1),e()),i&2){let c=a.$implicit;s(),g(" ",c.categoria," ")}}function nt(i,a){i&1&&(o(0,"th",28),n(1," Fecha Inicio "),e())}function at(i,a){if(i&1&&(o(0,"td",29),n(1),y(2,"date"),e()),i&2){let c=a.$implicit;s(),g(" ",D(2,1,c.fechaInicio,"yyyy-MM-dd")," ")}}function rt(i,a){i&1&&(o(0,"th",28),n(1," Fecha Fin "),e())}function mt(i,a){if(i&1&&(o(0,"td",29),n(1),y(2,"date"),e()),i&2){let c=a.$implicit;s(),g(" ",D(2,1,c.fechaFin,"yyyy-MM-dd")," ")}}function lt(i,a){i&1&&(o(0,"th",30),n(1," Acciones "),e())}function ct(i,a){if(i&1){let c=j();o(0,"button",33),b("click",function(){h(c);let m=C().$implicit,t=C(2);return _(t.editProject(m.proyectoId))}),n(1,"Editar"),e()}}function st(i,a){if(i&1){let c=j();o(0,"button",34),b("click",function(){h(c);let m=C().$implicit,t=C(2);return _(t.deleteProject(m.proyectoId))}),n(1,"Eliminar"),e()}}function dt(i,a){if(i&1&&(o(0,"td",29),p(1,ct,2,0,"button",31)(2,st,2,0,"button",32),e()),i&2){let c=C(2);s(),d("ngIf",c.tienePermiso("btnEdit")),s(),d("ngIf",c.tienePermiso("btnDelete"))}}function pt(i,a){i&1&&l(0,"tr",35)}function ut(i,a){i&1&&l(0,"tr",36)}function ft(i,a){if(i&1){let c=j();o(0,"div",8)(1,"mat-form-field",13)(2,"mat-label"),n(3,"Buscar"),e(),o(4,"input",14),b("keyup",function(m){h(c);let t=C();return _(t.applyFilter(m))}),e()(),o(5,"table",15),v(6,16),p(7,Ye,2,0,"th",17)(8,Ze,2,1,"td",18),x(),v(9,19),p(10,et,2,0,"th",17)(11,tt,2,1,"td",18),x(),v(12,20),p(13,it,2,0,"th",17)(14,ot,2,1,"td",18),x(),v(15,21),p(16,nt,2,0,"th",17)(17,at,3,4,"td",18),x(),v(18,22),p(19,rt,2,0,"th",17)(20,mt,3,4,"td",18),x(),v(21,23),p(22,lt,2,0,"th",24)(23,dt,3,2,"td",18),x(),p(24,pt,1,0,"tr",25)(25,ut,1,0,"tr",26),e(),l(26,"mat-paginator",27),e()}if(i&2){let c=C();s(5),d("dataSource",c.dataSource),s(19),d("matHeaderRowDef",c.displayedColumns),s(),d("matRowDefColumns",c.displayedColumns),s(),d("pageSizeOptions",K(4,Ke))}}function Ct(i,a){i&1&&(o(0,"div",9),n(1," Sin proyectos "),e())}var Be=(()=>{let a=class a{constructor(r,m,t,u){this.projectService=r,this.router=m,this.snackBar=t,this.route=u,this.displayedColumns=["id","name","category","startDate","endDate","actions"],this.dataSource=new W,this.projectsCount=0,this.searchText="",this.permisosUsuario=[],this.vistaActual="",this.permisosDisponibles=[]}ngOnInit(){this.vistaActual=this.router.url,this.getProjects(),this.obtenerPermisos()}ngAfterViewInit(){this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}getProjects(){this.projectService.getProjects().subscribe(r=>{this.projectsCount=r.length,this.dataSource=new W(r),this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort})}applyFilter(r){this.dataSource.filter=r.target.value.trim().toLowerCase()}addProject(){this.router.navigate(["/dashboards/project/new"])}editProject(r){this.router.navigate([`/dashboards/project/${r}`])}deleteProject(r){this.projectService.deleteProject(r).subscribe(()=>{this.getProjects(),this.snackBar.open("Proyecto eliminado correctamente","Cerrar",{duration:3e3})})}obtenerPermisos(){let r=localStorage.getItem("userInformation");if(!r){console.warn("No se encontr\xF3 informaci\xF3n de usuario en localStorage.");return}let m=JSON.parse(r);console.log("vista actual ",this.vistaActual),console.log("permisos  ",m.permisos),this.permisosUsuario=m.permisos.filter(t=>t.vista.ruta===`${this.vistaActual}`),this.permisosDisponibles=this.permisosUsuario.map(t=>t.codigo),console.log("Permisos de esta vista:",this.permisosDisponibles)}tienePermiso(r){return this.permisosDisponibles.includes(r)}};a.\u0275fac=function(m){return new(m||a)(f(B),f(w),f(Le),f(N))},a.\u0275cmp=I({type:a,selectors:[["app-project-list"]],viewQuery:function(m,t){if(m&1&&(O($,5),O(q,5)),m&2){let u;H(u=Q())&&(t.paginator=u.first),H(u=Q())&&(t.sort=u.first)}},standalone:!0,features:[P],decls:15,vars:8,consts:[[1,"absolute","inset-0","flex","min-w-0","flex-col","overflow-hidden"],[1,"flex-auto"],[1,"flex","flex-auto","flex-col","justify-between","border-b","px-6","py-8","sm:flex-row","md:flex-col","md:px-8"],[1,"text-4xl","font-extrabold","leading-none","tracking-tight"],[1,"text-secondary","ml-0.5","font-medium"],[1,"mt-4","flex","items-center","sm:mt-0","md:mt-4"],["class","ml-4","mat-flat-button","",3,"color","click",4,"ngIf"],[1,"relative"],[1,"mat-elevation-z8"],[1,"border-t","p-8","text-center","text-4xl","font-semibold","tracking-tight","sm:p-16"],["mat-flat-button","",1,"ml-4",3,"click","color"],[3,"svgIcon"],[1,"ml-2","mr-1"],[1,"w-full"],["matInput","","placeholder","Filtrar proyectos",3,"keyup"],["mat-table","","matSort","",1,"w-full",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","name"],["matColumnDef","category"],["matColumnDef","startDate"],["matColumnDef","endDate"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","",3,"pageSizeOptions"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell",""],["mat-button","","color","accent",3,"click",4,"ngIf"],["mat-button","","color","warn",3,"click",4,"ngIf"],["mat-button","","color","accent",3,"click"],["mat-button","","color","warn",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(m,t){m&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"div")(4,"div",3),n(5," Proyectos "),e(),o(6,"div",4),p(7,We,1,1),n(8),y(9,"i18nPlural"),e()(),o(10,"div",5),p(11,Xe,4,2,"button",6),e()(),o(12,"div",7),p(13,ft,27,5,"div",8)(14,Ct,2,0,"div",9),e()()()),m&2&&(s(7),z(t.projectsCount>0?7:-1),s(),g(" ",D(9,4,t.projectsCount,K(7,Je))," "),s(3),d("ngIf",t.tienePermiso("btnAdd")),s(2),z(t.projectsCount>0?13:14))},dependencies:[M,te,ie,oe,Me,be,xe,Ie,je,ve,Pe,Se,Ee,ye,De,A,L,ce,le,Fe,$,ke,q,Te,k,T,F,U,V,R],encapsulation:2});let i=a;return i})();function gt(i,a){if(i&1&&(o(0,"mat-option",41),n(1),e()),i&2){let c=a.$implicit;d("value",c.categoriaId),s(),J(c.nombre)}}function ht(i,a){if(i&1&&(o(0,"mat-option",41),n(1),e()),i&2){let c=a.$implicit;d("value",c.unidadId),s(),J(c.nombre)}}var X=(()=>{let a=class a{constructor(r,m,t,u){this.fb=r,this.projectService=m,this.route=t,this.router=u,this.categorias=[],this.unidadesDeNegocio=[],this.projectId=null}ngOnInit(){this.projectForm=this.fb.group({proyectoId:[0],nombre:["",S.required],categoria:["",S.required],lugar:["NA"],unidadDeNegocio:["",S.required],fechaInicio:["",S.required],fechaFin:[""],estado:["NA"],cliente:["",S.required],necesidad:[""],direccion:[""],nombreContacto:[""],telefono:[""],empresa:[""],levantamiento:[""],planoArquitectonico:[""],diagramaIsometrico:[""],diagramaUnifilar:[""],materialesCatalogo:[""],materialesPresupuestados:[""],inventarioFinal:[""],cuadroComparativo:[""],proveedor:[""],manoDeObra:[""],personasParticipantes:[""],equipos:[""],herramientas:[""],indirectosCostos:[""],fianzas:[""],anticipo:[""],cotizacion:[""],ordenDeCompra:[""],contrato:[""],programaDeTrabajo:[""],avancesReportes:[""],comentarios:[""],hallazgos:[""],dosier:[""],rutaCritica:[""],factura:[""],pago:[""],utilidadProgramada:[""],utilidadReal:[""],financiamiento:[""],cierreProyectoActaEntrega:[""]}),this.getCategorias(),this.getUnidadesDeNegocio(),this.route.paramMap.subscribe(r=>{let m=r.get("id");!m||m==="new"?this.projectId=null:(this.projectId=Number(m),this.loadProject(this.projectId))})}getCategorias(){this.projectService.getCategorias().subscribe(r=>this.categorias=r)}getUnidadesDeNegocio(){this.projectService.getUnidadesDeNegocio().subscribe(r=>this.unidadesDeNegocio=r)}loadProject(r){this.projectService.getProjectById(this.projectId).subscribe(m=>{let t=m;t&&this.projectForm.patchValue({proyectoId:t.proyectoId,nombre:t.nombre,categoria:t.categoriaId,lugar:t.lugar,unidadDeNegocio:t.unidadDeNegocioId,fechaInicio:t.fechaInicio,fechaFin:t.fechaFin,estado:t.estado,cliente:t.cliente,necesidad:t.necesidad,direccion:t.direccion,nombreContacto:t.nombreContacto,telefono:t.telefono,empresa:t.empresa,levantamiento:t.levantamiento,planoArquitectonico:t.planoArquitectonico,diagramaIsometrico:t.diagramaIsometrico,diagramaUnifilar:t.diagramaUnifilar,materialesCatalogo:t.materialesCatalogo,materialesPresupuestados:t.materialesPresupuestados,inventarioFinal:t.inventarioFinal,cuadroComparativo:t.cuadroComparativo,proveedor:t.proveedor,manoDeObra:t.manoDeObra,personasParticipantes:t.personasParticipantes,equipos:t.equipos,herramientas:t.herramientas,indirectosCostos:t.indirectosCostos,fianzas:t.fianzas,anticipo:t.anticipo,cotizacion:t.cotizacion,ordenDeCompra:t.ordenDeCompra,contrato:t.contrato,programaDeTrabajo:t.programaDeTrabajo,avancesReportes:t.avancesReportes,comentarios:t.comentarios,hallazgos:t.hallazgos,dosier:t.dosier,rutaCritica:t.rutaCritica,factura:t.factura,pago:t.pago,utilidadProgramada:t.utilidadProgramada,utilidadReal:t.utilidadReal,financiamiento:t.financiamiento,cierreProyectoActaEntrega:t.cierreProyectoActaEntrega})})}saveProject(){if(console.log("guardar proyecto",this.projectForm),this.projectForm.invalid)return;let r=this.projectForm.value;console.log("data de proyecto ",r),this.projectId?(r.proyectoId=this.projectId,this.projectService.updateProject(r).subscribe(()=>{this.router.navigate(["/dashboards/project"])})):this.projectService.createProject(r).subscribe(()=>{this.router.navigate(["/dashboards/project"])})}};a.\u0275fac=function(m){return new(m||a)(f(he),f(B),f(N),f(w))},a.\u0275cmp=I({type:a,selectors:[["app-project-details"]],standalone:!0,features:[P],decls:134,vars:8,consts:[["picker1",""],["picker2",""],[1,"absolute","inset-0","flex","flex-col","overflow-hidden","p-6"],[1,"text-2xl","font-bold","mb-4"],[1,"flex","flex-col","gap-4","overflow-auto",3,"ngSubmit","formGroup"],["appearance","fill",1,"w-full"],["matInput","","formControlName","nombre"],["formControlName","categoria"],[3,"value",4,"ngFor","ngForOf"],["formControlName","unidadDeNegocio"],[1,"grid","grid-cols-2","gap-4"],["matInput","","formControlName","fechaInicio",3,"matDatepicker"],["matSuffix","",3,"for"],["matInput","","formControlName","fechaFin",3,"matDatepicker"],["matInput","","formControlName","estado"],["matInput","","formControlName","cliente"],["matInput","","formControlName","necesidad"],["matInput","","formControlName","direccion"],["matInput","","formControlName","nombreContacto"],["matInput","","formControlName","telefono"],["matInput","","formControlName","empresa"],["matInput","","formControlName","levantamiento"],["matInput","","formControlName","planoArquitectonico"],["matInput","","formControlName","diagramaIsometrico"],["matInput","","formControlName","diagramaUnifilar"],["matInput","","formControlName","materialesCatalogo"],["matInput","","formControlName","materialesPresupuestados"],["matInput","","formControlName","inventarioFinal"],["matInput","","formControlName","proveedor"],["matInput","","formControlName","indirectosCostos"],["matInput","","formControlName","fianzas"],["matInput","","formControlName","anticipo"],["matInput","","formControlName","pago"],["matInput","","formControlName","programaDeTrabajo"],["matInput","","formControlName","avancesReportes"],["matInput","","formControlName","comentarios"],["matInput","","formControlName","rutaCritica"],["matInput","","formControlName","cierreProyectoActaEntrega"],[1,"flex","justify-end","gap-2","mt-4"],["mat-raised-button","","color","primary","type","submit"],["mat-button","","color","warn","type","button",3,"click"],[3,"value"]],template:function(m,t){if(m&1){let u=j();o(0,"div",2)(1,"h1",3),n(2),e(),o(3,"form",4),b("ngSubmit",function(){return h(u),_(t.saveProject())}),o(4,"mat-form-field",5)(5,"mat-label"),n(6,"Nombre del Proyecto"),e(),l(7,"input",6),e(),o(8,"mat-form-field",5)(9,"mat-label"),n(10,"Categor\xEDa"),e(),o(11,"mat-select",7),p(12,gt,2,2,"mat-option",8),e()(),o(13,"mat-form-field",5)(14,"mat-label"),n(15,"Unidad de Negocio"),e(),o(16,"mat-select",9),p(17,ht,2,2,"mat-option",8),e()(),o(18,"div",10)(19,"mat-form-field",5)(20,"mat-label"),n(21,"Fecha de Inicio"),e(),l(22,"input",11)(23,"mat-datepicker-toggle",12)(24,"mat-datepicker",null,0),e(),o(26,"mat-form-field",5)(27,"mat-label"),n(28,"Fecha de Fin"),e(),l(29,"input",13)(30,"mat-datepicker-toggle",12)(31,"mat-datepicker",null,1),e()(),o(33,"mat-form-field",5)(34,"mat-label"),n(35,"Estado"),e(),l(36,"input",14),e(),o(37,"mat-form-field",5)(38,"mat-label"),n(39,"Cliente"),e(),l(40,"input",15),e(),o(41,"mat-form-field",5)(42,"mat-label"),n(43,"Necesidad"),e(),l(44,"input",16),e(),o(45,"mat-form-field",5)(46,"mat-label"),n(47,"Direcci\xF3n"),e(),l(48,"input",17),e(),o(49,"mat-form-field",5)(50,"mat-label"),n(51,"Nombre de Contacto"),e(),l(52,"input",18),e(),o(53,"mat-form-field",5)(54,"mat-label"),n(55,"Tel\xE9fono"),e(),l(56,"input",19),e(),o(57,"mat-form-field",5)(58,"mat-label"),n(59,"Empresa"),e(),l(60,"input",20),e(),o(61,"mat-form-field",5)(62,"mat-label"),n(63,"Levantamiento"),e(),l(64,"input",21),e(),o(65,"mat-form-field",5)(66,"mat-label"),n(67,"Plano Arquitect\xF3nico"),e(),l(68,"input",22),e(),o(69,"mat-form-field",5)(70,"mat-label"),n(71,"Diagrama Isom\xE9trico"),e(),l(72,"input",23),e(),o(73,"mat-form-field",5)(74,"mat-label"),n(75,"Diagrama Unifilar"),e(),l(76,"input",24),e(),o(77,"mat-form-field",5)(78,"mat-label"),n(79,"Materiales de Cat\xE1logo"),e(),l(80,"input",25),e(),o(81,"mat-form-field",5)(82,"mat-label"),n(83,"Materiales Presupuestados"),e(),l(84,"input",26),e(),o(85,"mat-form-field",5)(86,"mat-label"),n(87,"Inventario Final"),e(),l(88,"input",27),e(),o(89,"mat-form-field",5)(90,"mat-label"),n(91,"Proveedor"),e(),l(92,"input",28),e(),o(93,"mat-form-field",5)(94,"mat-label"),n(95,"Indirectos Costos"),e(),l(96,"input",29),e(),o(97,"mat-form-field",5)(98,"mat-label"),n(99,"Fianzas"),e(),l(100,"input",30),e(),o(101,"mat-form-field",5)(102,"mat-label"),n(103,"Anticipo"),e(),l(104,"input",31),e(),o(105,"mat-form-field",5)(106,"mat-label"),n(107,"Pago"),e(),l(108,"input",32),e(),o(109,"mat-form-field",5)(110,"mat-label"),n(111,"Programa de Trabajo"),e(),l(112,"input",33),e(),o(113,"mat-form-field",5)(114,"mat-label"),n(115,"Avances y Reportes"),e(),l(116,"input",34),e(),o(117,"mat-form-field",5)(118,"mat-label"),n(119,"Comentarios"),e(),l(120,"input",35),e(),o(121,"mat-form-field",5)(122,"mat-label"),n(123,"Ruta Cr\xEDtica"),e(),l(124,"input",36),e(),o(125,"mat-form-field",5)(126,"mat-label"),n(127,"Cierre del Proyecto (Acta de Entrega)"),e(),l(128,"input",37),e(),o(129,"div",38)(130,"button",39),n(131,"Guardar"),e(),o(132,"button",40),b("click",function(){return h(u),_(t.router.navigate(["/dashboards/project"]))}),n(133,"Cancelar"),e()()()()}if(m&2){let u=G(25),E=G(32);s(2),g(" ",t.projectId?"Editar Proyecto":"Nuevo Proyecto"," "),s(),d("formGroup",t.projectForm),s(9),d("ngForOf",t.categorias),s(5),d("ngForOf",t.unidadesDeNegocio),s(5),d("matDatepicker",u),s(),d("for",u),s(6),d("matDatepicker",E),s(),d("for",E)}},dependencies:[M,ee,_e,fe,de,pe,ue,Ce,ge,R,k,T,F,me,U,V,we,Ne,re,A,L,Ue,Ae,Re,Ve,ae],encapsulation:2});let i=a;return i})();var Xt=[{path:"",component:Be},{path:"new",component:X},{path:":id",component:X}];export{Xt as default};
