import{a as Ji,b as it,c as tt,d as et,e as F}from"./chunk-ZXXQPT2K.js";import{b as Xi,f as Yi}from"./chunk-EDLSFNUB.js";import{b as Ki}from"./chunk-AOYAXRMH.js";import{i as Ai,k as Pi}from"./chunk-YOGVNQSG.js";import{a as ji,b as Vi}from"./chunk-OXDELVB2.js";import{w as Ei}from"./chunk-D7BAGR3P.js";import{a as Zi,b as ii}from"./chunk-7HPJJM5R.js";import{a as Ti,c as Q,h as U,i as $,k as Wi,m as Y,n as J}from"./chunk-S5EGDSMZ.js";import{c as W,e as Ni,g as K,h as Bi,j as Qi,k as Ui,l as $i,m as qi,n as Gi,q as Hi,r as Z,s as X}from"./chunk-MFXYIEP5.js";import{O as Di,W as B,Y as Ri,ea as Li,ga as q,ja as Oi,ka as G,ma as H,na as z,s as zi}from"./chunk-GZIOB5VH.js";import"./chunk-QWI5PWUG.js";import"./chunk-2MWZZXHX.js";import{A as N,b as yi,d as Ci,e as Fi,f as Ii,h as Si,j as Mi,l as P,x as j,y as V,z as M}from"./chunk-N75GUXKZ.js";import{$a as l,$b as ni,A as mi,C as ri,Cb as _i,Db as C,Fa as hi,Fb as bi,Gb as ui,Gc as S,Hb as o,Ib as a,Jb as g,Nb as v,Tb as w,U as si,V as k,Vb as s,Zb as ci,_b as di,aa as T,ab as h,dc as p,ec as wi,f as E,fa as O,fb as pi,fc as f,ka as y,la as A,lb as gi,lc as I,m as oi,mc as D,nc as xi,oc as vi,tc as li,ua as b,ub as x,uc as fi,va as u,vc as ki,wb as r,x as ai}from"./chunk-PTZSXNKB.js";import"./chunk-NEB6MB4Y.js";var ct=(()=>{let c=class c{constructor(){}};c.\u0275fac=function(t){return new(t||c)},c.\u0275cmp=y({type:c,selectors:[["roles"]],standalone:!0,features:[I],decls:1,vars:0,template:function(t,n){t&1&&g(0,"router-outlet")},dependencies:[V],encapsulation:2,changeDetection:0});let e=c;return e})();function pt(e,c){if(e&1){let d=v();o(0,"li")(1,"mat-checkbox",10),w("change",function(){let t=b(d).$implicit,n=s(2).$implicit,m=s(2);return u(m.togglePermission(n.id,t.permisoId))}),p(2),a()()}if(e&2){let d=c.$implicit,i=s(2).$implicit,t=s(2);l(),r("checked",t.selectedPermissions[i.id]==null?null:t.selectedPermissions[i.id].includes(d.permisoId)),l(),f(" ",d.descripcionPermiso," ")}}function gt(e,c){if(e&1&&(o(0,"ul",12),x(1,pt,3,2,"li",13),a()),e&2){let d=s(3);l(),r("ngForOf",d.permisos)}}function _t(e,c){if(e&1){let d=v();o(0,"li",8)(1,"div",9)(2,"mat-checkbox",10),w("change",function(){let t=b(d).$implicit,n=s(2);return u(n.togglePermission(t.id,1))}),p(3),a()(),x(4,gt,2,1,"ul",11),a()}if(e&2){let d=c.$implicit,i=s(2);l(2),r("checked",(i.selectedPermissions[d.id]==null?null:i.selectedPermissions[d.id].length)>0),l(),f(" ",d.title," "),l(),r("ngIf",i.permisos.length>0)}}function bt(e,c){if(e&1){let d=v();o(0,"div",2)(1,"label",3)(2,"input",4),w("change",function(){let t=b(d).$implicit,n=s();return u(n.toggleGroup(t))}),a(),o(3,"span",5),p(4),a()(),o(5,"ul",6),x(6,_t,5,3,"li",7),a()()}if(e&2){let d=c.$implicit,i=s();l(2),r("checked",i.isGroupFullySelected(d)),l(2),wi(d.title),l(2),r("ngForOf",d.children)}}var nt=(()=>{let c=class c{constructor(i,t){this.rolService=i,this._changeDetectorRef=t,this.navigation=[],this.selectedPermissions={},this.permisosSeleccionados=new hi,this.permisos=[]}ngOnInit(){this.obtenerPermisos()}obtenerPermisos(){this.rolService.getPermisos().subscribe(i=>{this.permisos=i,console.log("Permisos obtenidos",this.permisos),this.initializePermissions(),this._changeDetectorRef.detectChanges()})}initializePermissions(){this.navigation.forEach(i=>{i.children.forEach(t=>{this.selectedPermissions[t.id]||(this.selectedPermissions[t.id]=[])})}),this._changeDetectorRef.detectChanges()}togglePermission(i,t){let n=this.selectedPermissions[i];n.includes(t)?this.selectedPermissions[i]=n.filter(m=>m!==t):n.push(t),this.emitirPermisos()}isGroupFullySelected(i){return i.children?.every(t=>this.selectedPermissions[t.id]?.length>0)??!1}toggleGroup(i){let t=!this.isGroupFullySelected(i);i.children.forEach(n=>{this.selectedPermissions[n.id]=t?this.permisos.map(m=>m.permisoId):[]}),this.emitirPermisos()}getSelectedViews(){return this.navigation.flatMap(i=>i.children.map(t=>{let n=this.selectedPermissions[t.id]||[];return n.length>0?{vistaId:t.id,permisos:n}:null}).filter(t=>t!==null))}emitirPermisos(){let i=this.getSelectedViews();this.permisosSeleccionados.emit(i)}};c.\u0275fac=function(t){return new(t||c)(h(F),h(S))},c.\u0275cmp=y({type:c,selectors:[["app-role-navigation"]],inputs:{navigation:"navigation",selectedPermissions:"selectedPermissions"},outputs:{permisosSeleccionados:"permisosSeleccionados"},decls:2,vars:1,consts:[[1,"navigation"],["class","group mt-4",4,"ngFor","ngForOf"],[1,"group","mt-4"],[1,"font-bold","flex","items-center"],["type","checkbox",3,"change","checked"],[1,"ml-2"],[1,"ml-6","mt-2","border-l-2","border-gray-300","pl-4"],["class","mb-2",4,"ngFor","ngForOf"],[1,"mb-2"],[1,"flex","items-center"],[3,"change","checked"],["class","ml-6 mt-1",4,"ngIf"],[1,"ml-6","mt-1"],[4,"ngFor","ngForOf"]],template:function(t,n){t&1&&(o(0,"div",0),x(1,bt,7,3,"div",1),a()),t&2&&(l(),r("ngForOf",n.navigation))},dependencies:[Fi,Ii,Zi],styles:[".navigation[_ngcontent-%COMP%]{max-width:400px;margin:auto;font-family:Arial,sans-serif}.navigation[_ngcontent-%COMP%]   .group[_ngcontent-%COMP%]{margin-bottom:15px;padding:10px;border:1px solid #ccc;border-radius:5px}.navigation[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:flex;align-items:center;cursor:pointer}.navigation[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{margin-right:10px}.navigation[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding-left:20px}"]});let e=c;return e})();var lt=(()=>{let c=class c{};c.\u0275fac=function(t){return new(t||c)},c.\u0275mod=A({type:c}),c.\u0275inj=T({imports:[zi,P,Di,B,Ri,Ki]});let e=c;return e})();var ot=(()=>{let c=class c{};c.\u0275fac=function(t){return new(t||c)},c.\u0275mod=A({type:c}),c.\u0275inj=T({imports:[P,ii,z,lt]});let e=c;return e})();var Ct=["matDrawer"],Ft=()=>({"=0":"No roles","=1":"rol",other:"roles"}),It=(e,c)=>({"dark:hover:bg-hover hover:bg-gray-100":e,"bg-primary-50 dark:bg-hover":c}),St=e=>["./",e];function Mt(e,c){if(e&1&&p(0),e&2){let d=s();f(" ",d.contactsCount," ")}}function zt(e,c){if(e&1&&(o(0,"a",19)(1,"div",20),g(2,"mat-icon",21),a(),o(3,"div",22)(4,"div",23),p(5),a()()()),e&2){let d=c.$implicit,i=s(3);r("ngClass",vi(4,It,!i.selectedContact||i.selectedContact.rolId!==d.rolId,i.selectedContact&&i.selectedContact.rolId===d.rolId))("routerLink",xi(7,St,d.rolId)),l(2),r("svgIcon","heroicons_solid:user-circle"),l(3),f(" ",d.nombreRol," ")}}function Dt(e,c){if(e&1&&(o(0,"div",18),p(1," Roles "),a(),bi(2,zt,6,9,"a",19,_i().trackByFn,!0)),e&2){let d=s();l(2),ui(d)}}function Rt(e,c){e&1&&(o(0,"div",17),p(1," There are no roles! "),a())}function Lt(e,c){e&1&&x(0,Dt,4,0)(1,Rt,2,0,"div",17),e&2&&C(c.length?0:1)}var ti=(()=>{let c=class c{constructor(i,t,n,m,_,L){this._activatedRoute=i,this._changeDetectorRef=t,this._rolService=n,this._document=m,this._router=_,this._fuseMediaWatcherService=L,this.contactsCount=0,this.contactsTableColumns=["name","email"],this.searchInputControl=new Qi,this._unsubscribeAll=new E}ngOnInit(){this.roles$=this._rolService.roles$,this._rolService.roles$.pipe(k(this._unsubscribeAll)).subscribe(i=>{this.contactsCount=i.length,this._changeDetectorRef.markForCheck()}),this._rolService.rol$.pipe(k(this._unsubscribeAll)).subscribe(i=>{this.selectedContact=i,this._changeDetectorRef.markForCheck()}),this.searchInputControl.valueChanges.pipe(k(this._unsubscribeAll),si(i=>this._rolService.searchRoles(i))).subscribe(),this.matDrawer.openedChange.subscribe(i=>{i||(this.selectedContact=null,this._changeDetectorRef.markForCheck())}),this._fuseMediaWatcherService.onMediaChange$.pipe(k(this._unsubscribeAll)).subscribe(({matchingAliases:i})=>{i.includes("lg")?this.drawerMode="side":this.drawerMode="over",this._changeDetectorRef.markForCheck()}),ai(this._document,"keydown").pipe(k(this._unsubscribeAll),mi(i=>(i.ctrlKey===!0||i.metaKey)&&i.key==="/")).subscribe(()=>{this.createContact()})}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}onBackdropClicked(){this._router.navigate(["./"],{relativeTo:this._activatedRoute}),this._changeDetectorRef.markForCheck()}createContact(){this._rolService.createRol().subscribe(i=>{this._router.navigate(["./",i.rolId],{relativeTo:this._activatedRoute}),this._changeDetectorRef.markForCheck()})}trackByFn(i,t){return t.id||i}};c.\u0275fac=function(t){return new(t||c)(h(j),h(S),h(F),h(yi),h(M),h(Pi))},c.\u0275cmp=y({type:c,selectors:[["roles-list"]],viewQuery:function(t,n){if(t&1&&ci(Ct,7),t&2){let m;di(m=ni())&&(n.matDrawer=m.first)}},standalone:!0,features:[I],decls:27,vars:18,consts:[["matDrawer",""],[1,"absolute","inset-0","flex","min-w-0","flex-col","overflow-hidden"],[1,"bg-card","h-full","flex-auto","dark:bg-transparent",3,"backdropClick"],[1,"w-full","dark:bg-gray-900","md:w-160",3,"mode","opened","position","disableClose"],[1,"flex","flex-col"],[1,"flex-auto"],[1,"flex","flex-auto","flex-col","justify-between","border-b","px-6","py-8","sm:flex-row","md:flex-col","md:px-8"],[1,"text-4xl","font-extrabold","leading-none","tracking-tight"],[1,"text-secondary","ml-0.5","font-medium"],[1,"mt-4","flex","items-center","sm:mt-0","md:mt-4"],["subscriptSizing","dynamic",1,"fuse-mat-dense","fuse-mat-rounded","w-full","min-w-50"],["matPrefix","",1,"icon-size-5"],["matInput","",3,"formControl","autocomplete","placeholder"],["mat-flat-button","",1,"ml-4",3,"click","color"],[3,"svgIcon"],[1,"ml-2","mr-1"],[1,"relative"],[1,"border-t","p-8","text-center","text-4xl","font-semibold","tracking-tight","sm:p-16"],[1,"text-secondary","sticky","top-0","z-10","-mt-px","border-b","border-t","bg-gray-50","px-6","py-1","font-medium","uppercase","dark:bg-gray-900","md:px-8"],[1,"z-20","flex","cursor-pointer","items-center","border-b","px-6","py-4","md:px-8",3,"ngClass","routerLink"],[1,"flex","h-10","w-10","flex-0","items-center","justify-center","overflow-hidden","rounded-full"],["matPrefix","",1,"icon-size-5",3,"svgIcon"],[1,"ml-4","min-w-0"],[1,"truncate","font-medium","leading-5"]],template:function(t,n){if(t&1){let m=v();o(0,"div",1)(1,"mat-drawer-container",2),w("backdropClick",function(){return b(m),u(n.onBackdropClicked())}),o(2,"mat-drawer",3,0),g(4,"router-outlet"),a(),o(5,"mat-drawer-content",4)(6,"div",5)(7,"div",6)(8,"div")(9,"div",7),p(10," Roles "),a(),o(11,"div",8),x(12,Mt,1,1),p(13),li(14,"i18nPlural"),a()(),o(15,"div",9)(16,"div",5)(17,"mat-form-field",10),g(18,"mat-icon",11)(19,"input",12),a()(),o(20,"button",13),w("click",function(){return b(m),u(n.createContact())}),g(21,"mat-icon",14),o(22,"span",15),p(23,"Add"),a()()()(),o(24,"div",16),x(25,Lt,2,1),li(26,"async"),a()()()()()}if(t&2){let m;l(2),r("mode",n.drawerMode)("opened",!1)("position","end")("disableClose",!0),l(10),C(n.contactsCount>0?12:-1),l(),f(" ",ki(14,12,n.contactsCount,D(17,Ft))," "),l(6),r("formControl",n.searchInputControl)("autocomplete","off")("placeholder","Search roles"),l(),r("color","primary"),l(),r("svgIcon","heroicons_outline:plus"),l(4),C((m=fi(26,15,n.roles$))?25:-1,m)}},dependencies:[et,it,tt,Ji,V,$,U,Q,z,H,J,Y,Z,W,K,X,$i,G,q,Ci,N,Si,Mi],encapsulation:2,changeDetection:0});let e=c;return e})();var at=()=>["../"];function Tt(e,c){if(e&1&&(o(0,"div",15),g(1,"mat-icon"),o(2,"div",16),p(3),a()()),e&2){let d=s(2);l(3),f(" ",d.rol.nombreRol," ")}}function Ot(e,c){if(e&1){let d=v();o(0,"div",1),g(1,"img",2),o(2,"div",3)(3,"a",4),g(4,"mat-icon",5),a()()(),o(5,"div",6)(6,"div",7)(7,"div",8)(8,"div",9)(9,"button",10),w("click",function(){b(d);let t=s();return u(t.toggleEditMode(!0))}),g(10,"mat-icon",11),o(11,"span",12),p(12,"Edit"),a()()()(),o(13,"div",13),p(14),a(),o(15,"div",14),x(16,Tt,4,1,"div",15),a()()()}if(e&2){let d=s();l(3),r("matTooltip","Close")("routerLink",D(7,at)),l(),r("svgIcon","heroicons_outline:x-mark"),l(5),r("color","primary"),l(),r("svgIcon","heroicons_outline:pencil-square"),l(4),f(" ",d.rol.nombreRol," "),l(2),C(d.rol.nombreRol?16:-1)}}function At(e,c){if(e&1){let d=v();o(0,"div",1),g(1,"img",2),o(2,"div",3)(3,"a",4),g(4,"mat-icon",5),a()()(),o(5,"div",17)(6,"div",7)(7,"form",18)(8,"div",19)(9,"mat-form-field",20)(10,"mat-label"),p(11,"Nombre Rol"),a(),g(12,"mat-icon",21)(13,"input",22),a()(),o(14,"app-role-navigation",23),w("permisosSeleccionados",function(t){b(d);let n=s();return u(n.actualizarPermisos(t))}),a(),o(15,"div",24)(16,"button",25),w("click",function(){b(d);let t=s();return u(t.deleteContact())}),p(17," Delete "),a(),o(18,"button",26),w("click",function(){b(d);let t=s();return u(t.toggleEditMode(!1))}),p(19," Cancel "),a(),o(20,"button",27),w("click",function(){b(d);let t=s();return u(t.updateContact())}),p(21," Save "),a()()()()()}if(e&2){let d=s();l(3),r("matTooltip","Close")("routerLink",D(17,at)),l(),r("svgIcon","heroicons_outline:x-mark"),l(3),r("formGroup",d.contactForm),l(2),r("subscriptSizing","dynamic"),l(3),r("svgIcon","heroicons_solid:user-circle"),l(),r("formControlName","nombreRol")("placeholder","Nombre Rol")("spellcheck",!1),l(),r("navigation",d.navigation)("selectedPermissions",d.selectedPermissions),l(2),r("color","warn")("matTooltip","Delete"),l(2),r("matTooltip","Cancel"),l(2),r("color","primary")("disabled",d.contactForm.invalid)("matTooltip","Save")}}var mt=(()=>{let c=class c{constructor(i,t,n,m,_,L,ei,rt,st,ht){this._activatedRoute=i,this._changeDetectorRef=t,this._usersListComponent=n,this._rolService=m,this._formBuilder=_,this._fuseConfirmationService=L,this._renderer2=ei,this._router=rt,this._overlay=st,this._viewContainerRef=ht,this.editMode=!1,this.tagsEditMode=!1,this._unsubscribeAll=new E,this.navigation=[]}ngOnInit(){this._usersListComponent.matDrawer.open(),this.contactForm=this._formBuilder.group({rolId:[""],nombreRol:["",[Ni.required]],vistas:[[]]}),this._rolService.rol$.pipe(k(this._unsubscribeAll)).subscribe(i=>{this._usersListComponent.matDrawer.open(),this.rol=i,console.log("Informaci\xF3n de rol recibida: ",i);let t=i.vistas.map(m=>({vistaId:m.vistaId,nombreVista:m.nombreVista,permisos:i.permisos.filter(_=>_.vista?.vistaId===m.vistaId).map(_=>_.permisoId)}));console.log("Vistas con permisos asignados: ",t);let n={};t.forEach(m=>{n[m.nombreVista]=m.permisos}),console.log("Permisos seleccionados: ",n),this.contactForm.patchValue({rolId:i.rolId,nombreRol:i.nombreRol,vistas:t}),this.selectedPermissions=n,this._changeDetectorRef.markForCheck()}),this._rolService.rol$.pipe(k(this._unsubscribeAll)).subscribe(i=>{this._usersListComponent.matDrawer.open(),this.rol=i,console.log("informacion de rol ",i),this.contactForm.patchValue(i),this.toggleEditMode(!1),this._changeDetectorRef.markForCheck()}),this._rolService.getNavigation().subscribe(i=>{this.navigation=i.default2||[],console.log("navigation data ",this.navigation),this._changeDetectorRef.markForCheck()})}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete(),this._tagsPanelOverlayRef&&this._tagsPanelOverlayRef.dispose()}closeDrawer(){return this._usersListComponent.matDrawer.close()}toggleEditMode(i=null){i===null?this.editMode=!this.editMode:this.editMode=i,this._changeDetectorRef.markForCheck()}updateContact(){let i=this.contactForm.getRawValue();console.log("Nuevo rol ",i),this._rolService.updateRoles(i).subscribe(()=>{this.toggleEditMode(!1)})}deleteContact(){this._fuseConfirmationService.open({title:"Delete rol",message:"Are you sure you want to delete this rol? This action cannot be undone!",actions:{confirm:{label:"Delete"}}}).afterClosed().subscribe(t=>{if(t==="confirmed"){let n=this.rol.id,m=this.roles.findIndex(ei=>ei.id===n),_=m+(m===this.roles.length-1?-1:1),L=this.roles.length===1&&this.roles[0].id===n?null:this.roles[_].id;this._changeDetectorRef.markForCheck()}})}trackByFn(i,t){return t.id||i}actualizarPermisos(i){this.contactForm.patchValue({vistas:i}),console.log("Permisos actualizados en el formulario:",this.contactForm.value)}togglePermiso(i,t,n){let m=this.navigation.find(_=>_.id===i);m&&(n?m.permisosSeleccionados.includes(t)||m.permisosSeleccionados.push(t):m.permisosSeleccionados=m.permisosSeleccionados.filter(_=>_!==t),console.log("Permisos seleccionados:",this.navigation))}};c.\u0275fac=function(t){return new(t||c)(h(j),h(S),h(ti),h(F),h(Hi),h(Ai),h(pi),h(M),h(Ei),h(gi))},c.\u0275cmp=y({type:c,selectors:[["roles-details"]],standalone:!0,features:[I],decls:3,vars:2,consts:[[1,"flex","w-full","flex-col"],[1,"relative","h-40","w-full","bg-accent-100","px-8","dark:bg-accent-700","sm:h-48","sm:px-12"],["src","images/pages/profile/cover-jr.jpg",1,"absolute","inset-0","h-full","w-full","object-cover"],[1,"mx-auto","flex","w-full","max-w-3xl","items-center","justify-end","pt-6"],["mat-icon-button","",3,"matTooltip","routerLink"],[1,"text-white",3,"svgIcon"],[1,"relative","flex","flex-auto","flex-col","items-center","p-6","pt-0","sm:p-12","sm:pt-0"],[1,"w-full","max-w-3xl"],[1,"-mt-16","flex","flex-auto","items-end"],[1,"mb-1","ml-auto","flex","items-center"],["mat-flat-button","",3,"click","color"],[3,"svgIcon"],[1,"ml-2"],[1,"mt-3","truncate","text-4xl","font-bold"],[1,"mt-4","flex","flex-col","space-y-8","border-t","pt-6"],[1,"flex","sm:items-center"],[1,"ml-6","leading-6"],[1,"relative","flex","flex-auto","flex-col","items-center","px-6","sm:px-12"],[3,"formGroup"],[1,"mt-8"],[1,"w-full",3,"subscriptSizing"],["matPrefix","",1,"hidden","icon-size-5","sm:flex",3,"svgIcon"],["matInput","",3,"formControlName","placeholder","spellcheck"],[3,"permisosSeleccionados","navigation","selectedPermissions"],[1,"-mx-6","mt-10","flex","items-center","border-t","bg-gray-50","py-4","pl-1","pr-4","dark:bg-transparent","sm:-mx-12","sm:pl-7","sm:pr-12"],["mat-button","",3,"click","color","matTooltip"],["mat-button","",1,"ml-auto",3,"click","matTooltip"],["mat-flat-button","",1,"ml-2",3,"click","color","disabled","matTooltip"]],template:function(t,n){t&1&&(o(0,"div",0),x(1,Ot,17,8)(2,At,22,18),a()),t&2&&(l(),C(n.editMode?-1:1),l(),C(n.editMode?2:-1))},dependencies:[G,q,Oi,Vi,ji,N,z,H,Z,Ui,W,K,Bi,X,qi,Gi,B,$,U,Ti,Q,J,Y,ii,Xi,Li,Yi,Wi,ot,nt],encapsulation:2,changeDetection:0});let e=c;return e})();var Pt=(e,c)=>{let d=O(F),i=O(M);return console.log("parametro ",e.paramMap.get("id")),d.getUserById(e.paramMap.get("id")).pipe(ri(t=>{console.error(t);let n=c.url.split("/").slice(0,-1).join("/");return i.navigateByUrl(n),oi(t)}))},jt=(e,c,d,i)=>{let t=i.root;for(;t.firstChild;)t=t.firstChild;return!i.url.includes("/roles")||t.paramMap.get("id")?!0:e.closeDrawer().then(()=>!0)},mc=[{path:"",component:ct,children:[{path:"",component:ti,resolve:{roles:()=>O(F).getRoles()},children:[{path:":id",component:mt,resolve:{rol:Pt},canDeactivate:[jt]}]}]}];export{mc as default};
