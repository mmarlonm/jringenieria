import{a as m}from"./chunk-SV77WDVB.js";import{a as f}from"./chunk-IZQLVHST.js";import{p as d}from"./chunk-SNHPLNSL.js";import{$ as p,U as l,fa as u,l as s,m as h}from"./chunk-GIWUYSEV.js";var a=class{static isTokenExpired(t,r){if(!t||t==="")return!0;let e=this._getTokenExpirationDate(t);return r=r||0,e===null?!0:!(e.valueOf()>new Date().valueOf()+r*1e3)}static _b64decode(t){let r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e="";if(t=String(t).replace(/=+$/,""),t.length%4===1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(let o=0,c,i,g=0;i=t.charAt(g++);~i&&(c=o%4?c*64+i:i,o++%4)?e+=String.fromCharCode(255&c>>(-2*o&6)):0)i=r.indexOf(i);return e}static _b64DecodeUnicode(t){return decodeURIComponent(Array.prototype.map.call(this._b64decode(t),r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join(""))}static _urlBase64Decode(t){let r=t.replace(/-/g,"+").replace(/_/g,"/");switch(r.length%4){case 0:break;case 2:{r+="==";break}case 3:{r+="=";break}default:throw Error("Illegal base64url string!")}return this._b64DecodeUnicode(r)}static _decodeToken(t){if(!t)return null;let r=t.split(".");if(r.length!==3)throw new Error("The inspected token doesn't appear to be a JWT. Check to make sure it has three parts and see https://jwt.io for more.");let e=this._urlBase64Decode(r[1]);if(!e)throw new Error("Cannot decode the token.");return JSON.parse(e)}static _getTokenExpirationDate(t){let r=this._decodeToken(t);if(!r.hasOwnProperty("exp"))return null;let e=new Date(0);return e.setUTCSeconds(r.exp),e}};var x=(()=>{let t=class t{constructor(){this.apiUrl=`${f.apiUrl}/Auth`,this._authenticated=!1,this._httpClient=u(d),this._userService=u(m)}set accessToken(e){localStorage.setItem("accessToken",e)}get accessToken(){return localStorage.getItem("accessToken")??""}set userInformation(e){localStorage.setItem("userInformation",e)}get userInformation(){return localStorage.getItem("userInformation")??""}forgotPassword(e){return this._httpClient.post("api/auth/forgot-password",e)}resetPassword(e){return this._httpClient.post("api/auth/reset-password",e)}signIn(e){return this._authenticated?h("User is already logged in."):this._httpClient.post(`${this.apiUrl}/login`,e).pipe(l(o=>(this.accessToken=o.token,this._authenticated=!0,this.userInformation=JSON.stringify(o.usuario),this._userService.user=o.usuario,s(o))))}signOut(){return localStorage.removeItem("accessToken"),localStorage.removeItem("userInformation"),this._authenticated=!1,s(!0)}signUp(e){return this._httpClient.post("api/auth/sign-up",e)}unlockSession(e){return this._httpClient.post("api/auth/unlock-session",e)}check(){if(this._authenticated)return s(!0);if(!this.accessToken)return s(!1);if(a.isTokenExpired(this.accessToken))return s(!1);let e=JSON.parse(this.userInformation);return this._userService.user=e,s(!0)}};t.\u0275fac=function(o){return new(o||t)},t.\u0275prov=p({token:t,factory:t.\u0275fac,providedIn:"root"});let n=t;return n})();export{a,x as b};
